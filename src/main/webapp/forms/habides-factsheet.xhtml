<html xmlns:f="http://www.w3.org/2002/xforms" xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:chiba="http://chiba.sourceforge.net/xforms">
    <head>
        <style type="text/css">
        
        	.buttons{
				border: 1px solid #ccc;
				background-color: #f0f0f0;
				padding: 5px;
			}

			.right_buttons {
				text-align: right;
				display: block;
				float:right;
			}
			.red{
				color:red;
				}
			.bold{
				font-weight: bold;
				padding-right:5px;
			}
			.bold label{
				font-weight: bold;
				padding-right:5px;
			}
			.bold span{
				font-weight: bold;
				padding-right:5px;
			}
			.semi-wide-inp input{
				width: 200px;
			}
			.wide-inp input{
				width: 600px;
			}
			.habides-repeat tr.repeat-header{
				display:none;
			}
			.regions{
				display:inline;
			}
			#group-bioreg{
				display:inline;				
			}
			#group-region{
				display:inline;				
			}
/*			.repeat
			.textarea value { width: auto;}*/
			.textarea .value {width: 100%;}
			
			.textarea label {width: 100%;}

			.alternatives textarea {width:100%;}
			.textarea &gt; .value {
				width:100%; 
			}

/*			.alternatives textarea{
				width:200px;
			}
			.alternatives, .textarea &gt; .value, textarea.alternatives{
				width:200px;
			}*/
			/* IE fixes */
			.group {border: 1px solid #BCD884; padding: 0.3em;}
			.group legend {border: 1px solid #BCD884;}
			.top_buttons {background-color: #F0F4EA;}
			.group table {border-collapse: collapse; background: transparent;}
			fieldset {background-color: #F0F4EA;}
			.filler-tab {background-color: #F0F4EA;}
			#workarea table {background: transparent;}
			.repeat-item {padding: 0.5em;}

		.freetext{
			margin-left:30px;
		}
		div.others{
			margin-left:30px;
		}
		.mygroup{
			background-color: #f0f4ea;
			border:1px solid #bcd884;
			padding:0.3em;
		}
		.output label{
			width:200px;
		}
		.output{
			 display:block;
		}
		.output .required label {
				background: none;
		}

		/* Fix for required star  */
			.required-symbol {
				display:none;
			}
			.my-required-symbol {
				color:red;
				padding-left:5px;
				font-weight: bold;
			}
			/*
			.required label {
				background: transparent url(resources/images/icon-required.gif) no-repeat right top;
				padding-right: 12px;
			} 
			*/
			.small-heading span{
				font-size:1.1em;
			}
			.divider{
				 width:25px;
				 display:block
			}
			.invalid .trigger{
				background: rgb(42, 100, 149)
			}
			.my-alert{
				border: thin solid #a42322;
				color: #a42322;
				font-weight: bold;
				padding:2px;
				background-color: #dae9bb;
			}
			
			</style>
        <title>HaBiDeS (Habitats and Birds Directive Derogation System)</title>
        <f:model id="main-model">
			<!-- ##########            DEFAULT instance          ############-->
            <f:instance id="default" src="{$instance}"/>
			<!-- instance for EMPTY XML structure -->
            <f:instance xmlns="" id="emptyinstance">
                <data/>
            </f:instance>
			<!-- ##########            SUBMISSIONS          ############-->
			<!-- submission for replacing missing instance data with empty instance file, otherwise it's not possible to retreive the XML structure-->
            <f:submission id="get-emptyinstance" method="post" action="http://webqdev.eionet.europa.eu/xml/habides-derogations-instance.xml" replace="instance" ref="'emptyinstance'"/>
			<!--submission for finish filling webform - stores the data and opens envelope page -->
            <f:submission id="finish" f:action="{$base_uri}WebQServlet?mode=finish&amp;instance_id={$instance_id}" f:method="post" replace="instance" f:encoding="UTF-8" instance="saveresult" validate="false">
                <f:message ev:event="xforms-submit-error">Error on saving data!</f:message>
                <f:load ev:event="xforms-submit-done" resource="{$base_uri}WebQServlet?mode=envelope&amp;instance_id={$instance_id}" show="replace"/>
            </f:submission>
            <f:submission id="savedraft" action="{$base_uri}WebQServlet?mode=save&amp;instance_id={$instance_id}" method="post" replace="instance" encoding="UTF-8" instance="saveresult" validate="false">
                <f:message ev:event="xforms-submit-done" ref="instance('saveresult')/message"/>
                <f:message ev:event="xforms-submit-error">Error on saving data!</f:message>
				<!--f:load  ev:event="xforms-submit-done" resource="{$base_uri}WebQServlet?mode=opensave" show="replace"/-->
            </f:submission>
			<!-- save xml into webq tmp folder -->
            <f:submission id="savetmp" action="{$base_uri}WebQServlet?mode=savetmp&amp;instance_id={$instance_id}" method="post" replace="none" encoding="UTF-8" validate="false"/>
			
			<!-- ##########           HELPER INSTANCE - saving messages         ############-->

			<!-- instance for showing save result messages from WebQ system -->
            <f:instance xmlns="" id="saveresult">
                <result>
                    <code desc="Result code: 0-ERROR;1-OK">-1</code>
                    <message desc="Save result message"/>
                    <result_time desc="Result time"/>
                    <last_modified desc="Last modified"/>
                </result>
            </f:instance>
			<!-- bindings for save result -->
            <f:bind nodeset="instance('saveresult')/code" id="has-save-info" relevant=". &gt; -1" type="integer"/>
            <f:bind nodeset="instance('saveresult')/last_modified" id="save-success" relevant="../code=1"/>
            <f:bind nodeset="instance('saveresult')/message" id="save-error" relevant="../code=0"/>

			<!-- ##########            DEFAULT instance BINDINGS          ############-->
				<!--f:bind id="b-lang" f:nodeset="/derogations/@xml:lang" required="true()"/-->
            <f:bind id="b-country" f:nodeset="/derogations/@country" required="true()"/>
            <f:bind f:nodeset="derogation/@derogation_reference" required="true()"/>
				<!--f:bind id="b-user_derog_ref" f:nodeset="derogation/@user_derogation_ref"/-->
				
				<!--f:bind id="b-derogations" nodeset="/derogations/derogation"/>
				<f:bind id="b-useridentity" f:nodeset="derogation/@userIdentity"/-->
            <f:bind id="b-directive" f:nodeset="derogation/@directive" required="true()"/>
            <f:bind id="b-licensingAuthority" f:nodeset="derogation/licensingAuthority" required="true()"/>
            <f:bind id="b-validFrom" type="string" f:nodeset="derogation/licenseValidFrom" required="true()"/>
            <f:bind id="b-validUntil" type="string" f:nodeset="derogation/licenseValidUntil" required="true()"/>
            <f:bind id="b-sensitive" type="string" f:nodeset="derogation/sensitive"/>
            <f:bind id="b-numberOfLicenses" type="integer" f:nodeset="derogation/numberOfLicenses"/>
            <f:bind id="b-alternativesAssessed" f:nodeset="derogation/alternativesAssessed" required="true()"/>

		<!-- conditionally required -->
            <f:bind id="b-strictlySupervisedConditions" f:nodeset="derogation/strictlySupervisedConditions" required="true()"/>
            <f:bind id="b-selectiveBasis" f:nodeset="derogation/selectiveBasis" required="true()"/>
            <f:bind id="b-derogationJustification" f:nodeset="derogation/derogationJustification" required="false()"/>
				<!-- required -->
            <f:bind id="b-impactOnPopulation" f:nodeset="derogation/impactOnPopulation" required="true()"/>
            <f:bind id="b-supervisoryMeasure" f:nodeset="derogation/supervisoryMeasure" required="true()"/>
            <f:bind id="b-individuals" type="long" f:nodeset="derogation/licensed/individuals"/>
            <f:bind id="b-eggs" type="long" f:nodeset="derogation/licensed/eggs"/>
            <f:bind id="b-breeding" type="long" f:nodeset="derogation/licensed/breeding"/>
            <f:bind id="b-resting" type="long" f:nodeset="derogation/licensed/resting"/>
            <f:bind id="b-nests" type="long" f:nodeset="derogation/licensed/nests"/>
            <f:bind id="b-otherNumber" type="long" f:nodeset="derogation/licensed/otherNumber"/>
            <f:bind id="b-act-individuals" type="long" f:nodeset="derogation/actuallyTaken/individuals"/>
            <f:bind id="b-act-eggs" type="long" f:nodeset="derogation/actuallyTaken/eggs"/>
            <f:bind id="b-act-breeding" type="long" f:nodeset="derogation/actuallyTaken/breeding"/>
            <f:bind id="b-act-resting" type="long" f:nodeset="derogation/actuallyTaken/resting"/>
            <f:bind id="b-act-nests" type="long" f:nodeset="derogation/actuallyTaken/nests"/>
            <f:bind id="b-act-otherNumber" type="long" f:nodeset="derogation/actuallyTaken/otherNumber"/>
            <f:bind id="b-pop-individuals" type="long" f:nodeset="derogation/populationSize/individuals"/>
            <f:bind id="b-pop-breedingPairs" type="long" f:nodeset="derogation/populationSize/breedingPairs"/>
            <f:bind id="b-pop-otherNumber" type="long" f:nodeset="derogation/populationSize/otherNumber"/>

				<!--f:bind id="b-bioRegions" f:nodeset="derogation/bioRegions"/>
				<f:bind id="b-regions" f:nodeset="derogation/regions"/-->
            <f:bind id="b-species" f:nodeset="derogation/species" required="true()" constraint="string-length(.) &gt; 0"/> <!--readonly="instance('context')/speciesFreetextf='false'"/>-->

			<!-- ##########           HELPER   BINDINGS          ############-->
            <f:bind id="b-derogation-tblempty" nodeset="instance('context')/tblDerogEmpty" f:relevant="count(instance('default')/derogation)=1 and  string-length(instance('default')/derogation[1]/@directive)=0"/>
            <f:bind id="b-derogation-tblfilled" nodeset="instance('context')/tblDerogFilled" f:relevant="count(instance('default')/derogation) &gt; 1 or  string-length(instance('default')/derogation[1]/@directive)&gt;0"/>

			<!--f:bind id="b-is-birds" nodeset="instance('context')/isBirdsDirective" f:relevant="instance('default')/derogation[index('rDerogList')]/@directive = instance('directives')/directive[@type='birds']/@id"/>
			<f:bind id="b-is-habitats" nodeset="instance('context')/isHabitatsDirective" f:relevant="instance('default')/derogation[index('rDerogList')]/@directive = instance('directives')/directive[@type='habitats']/@id"/-->
            <f:bind id="b-bioreg-tblempty" nodeset="instance('context')/tblBioRegEmpty" /><!-- f:relevant="count(instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion)=1 and instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion='' and instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion/@code=''"/> -->
            <f:bind id="b-bioreg-tblfilled" nodeset="instance('context')/tblBioRegFilled" /><!-- f:relevant="count(instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion) &gt; 1 or  derogation[index('rDerogList')]/bioRegions/bioRegion !=''  and instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion/@code!=''"/>-->
            <f:bind id="b-species-tblfilled" nodeset="instance('context')/tblSpeciesFilled"  /><!--f:relevant="count(instance('default')/derogation[index('rDerogList')]/species) &gt; 1 or   instance('default')/derogation[index('rDerogList')]/species !='' "/>-->
            <f:bind id="b-species-tblempty" nodeset="instance('context')/tblSpeciesEmpty"  /><!--f:relevant="count(instance('default')/derogation[index('rDerogList')]/species) = 1 and  instance('default')/derogation[index('rDerogList')]/species ='' "/>-->
<!--
			<f:bind id="b-species-tblfilled" nodeset="instance('context')/tblSpeciesFilled" f:relevant="count(instance('helper_default')/derogation/species) > 1 or  instance('helper_default')/derogation/species !='' "/>
			<f:bind id="b-species-tblempty" nodeset="instance('context')/tblSpeciesEmpty" f:relevant="count(instance('helper_default')/derogation/species) = 1 and  instance('helper_default')/derogation/species ='' "/>
-->
            <f:bind id="b-region-tblfilled" nodeset="instance('context')/tblRegionFilled"  /><!--f:relevant="count(instance('default')/derogation[index('rDerogList')]/regions/region) &gt; 1 or  derogation[index('rDerogList')]/regions/region !=''  and instance('default')/derogation[index('rDerogList')]/regions/region/@code!=''"/> -->
            <f:bind id="b-region-tblempty" nodeset="instance('context')/tblRegionEmpty"  /><!--f:relevant="count(instance('default')/derogation[index('rDerogList')]/regions/region)=1 and instance('default')/derogation[index('rDerogList')]/regions/region='' and instance('default')/derogation[index('rDerogList')]/regions/region/@code=''"/> -->
            <f:bind id="b-activity-tblempty" nodeset="instance('context')/tblActivityEmpty"  /><!--f:relevant="count(instance('default')/derogation[index('rDerogList')]/activities/activity)=1 and instance('default')/derogation[index('rDerogList')]/activities/activity='' and instance('default')/derogation[index('rDerogList')]/activities/activity/@code=''"/> -->
            <f:bind id="b-activity-tblfilled" nodeset="instance('context')/tblActivityFilled"  /><!--f:relevant="count(instance('default')/derogation[index('rDerogList')]/activities/activity) &gt; 1 or  derogation[index('rDerogList')]/activities/activity !=''  and instance('default')/derogation[index('rDerogList')]/activities/activity/@code!=''"/> -->
            <f:bind id="b-method-tblempty" nodeset="instance('context')/tblMethodEmpty"  /><!--f:relevant="count(instance('default')/derogation[index('rDerogList')]/methods/method)=1 and instance('default')/derogation[index('rDerogList')]/methods/method='' and instance('default')/derogation[index('rDerogList')]/methods/method/@code=''"/> -->
            <f:bind id="b-method-tblfilled" nodeset="instance('context')/tblMethodFilled"  /><!--f:relevant="count(instance('default')/derogation[index('rDerogList')]/methods/method) &gt; 1 or  derogation[index('rDerogList')]/methods/method !=''  and instance('default')/derogation[index('rDerogList')]/methods/method/@code!=''"/> -->
            <f:bind id="b-reason-tblempty" nodeset="instance('context')/tblReasonEmpty"  /><!--f:relevant="count(instance('default')/derogation[index('rDerogList')]/reasons/reason)=1 and instance('default')/derogation[index('rDerogList')]/reasons/reason='' and instance('default')/derogation[index('rDerogList')]/reasons/reason/@code=''"/> -->
            <f:bind id="b-reason-tblfilled" nodeset="instance('context')/tblReasonFilled"  /><!--f:relevant="count(instance('default')/derogation[index('rDerogList')]/reasons/reason) &gt; 1 or  derogation[index('rDerogList')]/reasons/reason !=''  and instance('default')/derogation[index('rDerogList')]/reasons/reason/@code!=''"/> -->
            <f:bind id="b111" nodeset="instance('context')/selMainGroup" relevant="instance('context')/activeDirective='habitats' "/>
            <f:bind id="b222" nodeset="instance('context')/selMiddleGroup" relevant="instance('context')/activeDirective='habitats' "/>
            <f:bind id="b333" nodeset="instance('context')/selLowerGroup-birds" relevant="instance('context')/activeDirective='birds' "/>
            <f:bind id="b444" nodeset="instance('context')/selLowerGroup-habitats" relevant="instance('context')/activeDirective='habitats' "/>
            <f:bind id="b-sel-species-birds" nodeset="instance('context')/selSpecies-birds" relevant="instance('context')/activeDirective='birds' "/>
            <f:bind id="b-sel-species-habitats" nodeset="instance('context')/selSpecies-habitats" relevant="instance('context')/activeDirective='habitats' "/>&gt;
				
				<!--f:bind id="b-species-freetext" type="boolean" nodeset="instance('context')/speciesFreetext"/-->
            <f:bind id="b-species-freetext-value" nodeset="instance('context')/speciesFreetextValue"/><!-- readonly="string-length(instance('context')/selSpecies-birds)>0 or string-length(instance('context')/selSpecies-habitats)>0"/-->


					<!-- hack for comparing dates -->
            <f:bind id="b-contextValidFrom" type="date" f:nodeset="instance('context')/validFrom" required="true()" constraint=" ../validFromNum &lt; ../validUntilNum"/>
            <f:bind id="b-contextValidUntil" type="date" f:nodeset="instance('context')/validUntil" required="true()" constraint=" ../validFromNum &lt; ../validUntilNum"/>
            <f:bind id="b-contextSensitive" type="boolean" f:nodeset="instance('context')/sensitive"/>
            <f:bind id="b-contextValidFromNum" type="integer" f:nodeset="instance('context')/validFromNum"/>
            <f:bind id="b-contextValidUntilNum" type="integer" f:nodeset="instance('context')/validUntilNum"/>
            <f:bind id="b-lblEdit" f:nodeset="instance('context')/lblEdit" calculate="if(count(instance('default')/derogation)=1 and  instance('default')/derogation[1]/@directive='') then '' else 'Edit'"/>
            <f:bind id="b-lblView" f:nodeset="instance('context')/lblView" calculate="if(count(instance('default')/derogation)=1 and  instance('default')/derogation[1]/@directive='') then '' else 'View'"/>
            <f:bind id="b-lblDelete" f:nodeset="instance('context')/lblDelete" calculate="if(count(instance('default')/derogation)=1 and  instance('default')/derogation[1]/@directive='') then '' else 'Delete'"/>
            <f:bind id="b-lblCopy" f:nodeset="instance('context')/lblCopy" calculate="if(count(instance('default')/derogation)=1 and  instance('default')/derogation[1]/@directive='') then '' else 'Copy'"/>
            <f:bind id="b-sel-reason-birds" nodeset="instance('context')/selReason-birds" relevant="instance('context')/activeDirective='birds'"/>
            <f:bind id="b-sel-reason-habitats" nodeset="instance('context')/selReason-habitats" relevant="instance('context')/activeDirective='habitats' "/>
            <f:bind id="b-ft-reason" nodeset="instance('context')/ftReason" readonly="string-length(instance('context')/selReason-habitats)&gt;0 or string-length(instance('context')/selReason-birds)&gt;0 "/>
            <f:bind id="b-sel-activity-birds" nodeset="instance('context')/selActivity-birds" relevant="instance('context')/activeDirective='birds'"/>
            <f:bind id="b-sel-activity-habitats" nodeset="instance('context')/selActivity-habitats" relevant="instance('context')/activeDirective='habitats' "/>
            <f:bind id="b-ft-activity" nodeset="instance('context')/ftActivity" readonly="string-length(instance('context')/selActivity-habitats)&gt;0 or string-length(instance('context')/selActivity-birds)&gt;0 "/>
            <f:bind id="b-sel-method-birds" nodeset="instance('context')/selMethod-birds" relevant="instance('context')/activeDirective='birds'"/>
            <f:bind id="b-sel-method-habitats" nodeset="instance('context')/selMethod-habitats" relevant="instance('context')/activeDirective='habitats' "/>
            <f:bind id="b-ft-method" nodeset="instance('context')/ftMethod" readonly="string-length(instance('context')/selMethod-habitats)&gt;0 or string-length(instance('context')/selMethod-birds)&gt;0 "/>
			<!-- Directives -->
            <f:instance xmlns="" id="directives">
                <directives>
                    <directive id="http://rod.eionet.europa.eu/obligations/268" type="habitats">Habitats Directive</directive>
                    <directive id="http://rod.eionet.europa.eu/obligations/276" type="birds">Birds Directive</directive>
                </directives>
            </f:instance>
			<!-- ##########       LABELS  INSTANCE         ############-->
			<!--f.instance xmlns="" id="labels">
			</f.instance-->
			<!-- ##########       CONTEXT  INSTANCE         ############-->
			<!-- CONTEXT parameters instance and bindings eg. webq-lang, envelope, ... -->
            <f:instance xmlns="" id="context">
                <data>
                    <tblDerogEmpty/>
                    <tblDerogFilled/>
                    <selBioRegion/>
                    <tblBioRegEmpty/>
                    <tblBioRegFilled/>
                    <tblSpeciesFilled/>
                    <tblSpeciesEmpty/>
                    <selRegion/>
                    <tblRegionEmpty/>
                    <tblRegionFilled/>
                    <ftActivity/>
                    <selActivity-birds/>
                    <selActivity-habitats/>
                    <tblActivityEmpty/>
                    <tblActivityFilled/>
                    <ftMethod/>
                    <selMethod-birds/>
                    <selMethod-habitats/>
                    <tblMethodEmpty/>
                    <tblMethodFilled/>
                    <ftReason/>
                    <tblReasonEmpty/>
                    <tblReasonFilled/>
                    <selReason-birds/>
                    <selReason-habitats/>
                    <selMainGroup/>
                    <selMiddleGroup/>
                    <selLowerGroup-birds/>
                    <selLowerGroup-habitats/>
					<!--lowerGroupLabel/-->
                    <selSpecies-birds/>
                    <selSpecies-habitats/>
					<!--speciesFreetext>false</speciesFreetext-->
                    <speciesFreetextValue/>
                    <isBirdsDirective/>
                    <isHabitatsDirective/>
                    <validUntil/>
                    <validFrom/>
                    <validFromNum/>
                    <validUntilNum/>
                    <lblEdit/>
                    <lblView/>
                    <lblDelete/>
                    <lblCopy/>
                    <user/>
                    <activeDirective>habitats</activeDirective>
                    <derogIndex>0</derogIndex>
                    <countrySelected/>
                    <countryNotSelected/>
                    <sensitive/>
                </data>
            </f:instance>
            <f:instance xmlns="" id="regions" src="{$base_uri}xml/habides_nuts2_lookup.xml"/>
            <f:bind id="b-country-selected" nodeset="instance('context')/countrySelected" relevant="string-length(instance('default')/@country) &gt; 0"/>
            <f:bind id="b-country-not-selected" nodeset="instance('context')/countryNotSelected" relevant="string-length(instance('default')/@country)=0"/>
            <f:bind id="b-region" nodeset="instance('regions')//nuts2[(substring(code,1,2) = instance('default')/@country)]">
                <f:bind id="b-region-code" nodeset="code"/>
                <f:bind id="b-region-descr" nodeset="description" calculate="concat(../code,' - ', ../name)"/>
            </f:bind>
            <f:bind id="b-region-all" nodeset="instance('regions')//nuts2">
                <f:bind id="b-region-code-all" nodeset="code"/>
                <f:bind id="b-region-descr-all" nodeset="description2" calculate="concat(../code,' - ', ../name)"/>
            </f:bind>
			
			
			<!-- trigger that loads context paramters into context instance-->
            <!--
            <f:action ev:event="xforms-ready">
                <f:send submission="get-emptyinstance" name="xforms-submit"/>
                <f:setvalue ref="/derogations/@country" value="if(string-length(/derogations/@country) &gt; 0,/derogations/@country,instance('countries')/data[lower-code='EE' or code='EE']/code)"/>
                <f:setvalue ref="instance('context')/user" value="instance('default')/derogation[1]/@userIdentity"/>
            </f:action>
            -->
            <f:action ev:event="my-reset-edits">
                <f:setvalue f:ref="instance('context')/selBioRegion" value="''"/>
                <f:setvalue f:ref="instance('context')/selRegion" value="''"/>
                <f:setvalue f:ref="instance('context')/selActivity-birds" value="''"/>
                <f:setvalue f:ref="instance('context')/selActivity-habitats" value="''"/>
                <f:setvalue f:ref="instance('context')/ftActivity" value="''"/>
                <f:setvalue f:ref="instance('context')/ftMethod" value="''"/>
                <f:setvalue f:ref="instance('context')/selMethod-birds" value="''"/>
                <f:setvalue f:ref="instance('context')/selMethod-habitats" value="''"/>
                <f:setvalue f:ref="instance('context')/selReason-birds" value="''"/>
                <f:setvalue f:ref="instance('context')/selReason-habitats" value="''"/>
                <f:setvalue f:ref="instance('context')/ftReason" value="''"/>
                <f:setvalue f:ref="instance('context')/selMainGroup" value="''"/>
                <f:setvalue f:ref="instance('context')/selMiddleGroup" value="''"/>
                <f:setvalue f:ref="instance('context')/selLowerGroup-birds" value="''"/>
                <f:setvalue f:ref="instance('context')/selLowerGroup-habitats" value="''"/>
                <f:setvalue f:ref="instance('context')/selSpecies-birds" value="''"/>
                <f:setvalue f:ref="instance('context')/selSpecies-habitats" value="''"/>
                <f:setvalue f:ref="instance('context')/speciesFreetextValue" value="''"/>
                <f:refresh/>
            </f:action>
            <f:action ev:event="my-edit">
                <f:setvalue f:ref="instance('context')/validFrom" value="instance('default')/derogation[index('rDerogList')]/licenseValidFrom"/>
                <f:setvalue f:ref="instance('context')/validUntil" value="instance('default')/derogation[index('rDerogList')]/licenseValidUntil"/>
                <f:setvalue f:ref="instance('context')/sensitive" value="instance('default')/derogation[index('rDerogList')]/sensitive"/>
                <f:setvalue ref="instance('context')/derogIndex" value="index('rDerogList')"/>
                <f:setvalue f:ref="instance('context')/activeDirective" value="instance('directives')/directive[@id= instance('default')/derogation[index('rDerogList')]/@directive]/@type"/>
            </f:action>
            <f:action ev:event="my-set-directive">
                <f:setvalue ref="instance('context')/derogIndex" value="index('rDerogList')"/>
                <f:setvalue f:ref="instance('context')/activeDirective" value="instance('directives')/directive[@id= instance('default')/derogation[index('rDerogList')]/@directive]/@type"/>
            </f:action>
            <f:action ev:event="my-store-dates">
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licenseValidFrom" value="instance('context')/validFrom"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licenseValidUntil" value="instance('context')/validUntil"/>
				<!--f:setvalue f:ref="instance('context')/validFrom" value="''" />
				<f:setvalue f:ref="instance('context')/validUntil" value="''" /-->
            </f:action>
            <f:action ev:event="my-insert">
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/@directive" value="instance('directives')/directive[@type=instance('context')/activeDirective]/@id"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/@userIdentity" value="instance('context')/user"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/@derogation_reference" value="concat(instance('default')/derogation[index('rDerogList')]/@userIdentity,'-',if(instance('context')/activeDirective='birds') then 'B'  else 'H','-',count(instance('default')/derogation[@directive=instance('directives')/directive[@type=instance('context')/activeDirective]/@id]),'-',substring(now(),1,4),substring(now(),6,2),substring(now(),9,2),substring(now(),12,2),substring(now(),15,2),substring(now(),18,2))"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/sensitive" value="'false'"/>
                <f:refresh/>
            </f:action>
            <f:action ev:event="my-reset-all">
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/@user_derogation_reference" value="''  "/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licensingAuthority" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licenseValidFrom" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licenseValidUntil" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/sensitive" value="'false'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/numberOfLicenses" value="''"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/species" at="10"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/species" at="9"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/species" at="8"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/species" at="7"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/species" at="6"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/species" at="5"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/species" at="4"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/species" at="3"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/species" at="2"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/species[1]" value="''"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)=1) then  0 else count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)=1) then  0 else count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)=1) then  0 else count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)=1) then  0 else count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)=1) then  0 else count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)=1) then  0 else count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)=1) then  0 else count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)=1) then  0 else count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)=1) then  0 else count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)=1) then  0 else count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[1]" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion/@code[1]" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/location" value="''"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/regions/region" at="if(count(/derogations/derogation[index('rDerogList')]/regions/region)=1,0,count(/derogations/derogation[index('rDerogList')]/regions/region))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/regions/region" at="if(count(/derogations/derogation[index('rDerogList')]/regions/region)=1,0,count(/derogations/derogation[index('rDerogList')]/regions/region))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/regions/region" at="if(count(/derogations/derogation[index('rDerogList')]/regions/region)=1,0,count(/derogations/derogation[index('rDerogList')]/regions/region))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/regions/region" at="if(count(/derogations/derogation[index('rDerogList')]/regions/region)=1,0,count(/derogations/derogation[index('rDerogList')]/regions/region))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/regions/region" at="if(count(/derogations/derogation[index('rDerogList')]/regions/region)=1,0,count(/derogations/derogation[index('rDerogList')]/regions/region))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/regions/region" at="if(count(/derogations/derogation[index('rDerogList')]/regions/region)=1,0,count(/derogations/derogation[index('rDerogList')]/regions/region))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/regions/region" at="if(count(/derogations/derogation[index('rDerogList')]/regions/region)=1,0,count(/derogations/derogation[index('rDerogList')]/regions/region))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/regions/region" at="if(count(/derogations/derogation[index('rDerogList')]/regions/region)=1,0,count(/derogations/derogation[index('rDerogList')]/regions/region))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/regions/region" at="if(count(/derogations/derogation[index('rDerogList')]/regions/region)=1,0,count(/derogations/derogation[index('rDerogList')]/regions/region))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/regions/region" at="if(count(/derogations/derogation[index('rDerogList')]/regions/region)=1,0,count(/derogations/derogation[index('rDerogList')]/regions/region))"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/regions/region[1]" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/regions/region/@code[1]" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/alternativesAssessed" value="''"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/activities/activity" at="if(count(/derogations/derogation[index('rDerogList')]/activities/activity)=1,0,count(/derogations/derogation[index('rDerogList')]/activities/activity))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/activities/activity" at="if(count(/derogations/derogation[index('rDerogList')]/activities/activity)=1,0,count(/derogations/derogation[index('rDerogList')]/activities/activity))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/activities/activity" at="if(count(/derogations/derogation[index('rDerogList')]/activities/activity)=1,0,count(/derogations/derogation[index('rDerogList')]/activities/activity))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/activities/activity" at="if(count(/derogations/derogation[index('rDerogList')]/activities/activity)=1,0,count(/derogations/derogation[index('rDerogList')]/activities/activity))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/activities/activity" at="if(count(/derogations/derogation[index('rDerogList')]/activities/activity)=1,0,count(/derogations/derogation[index('rDerogList')]/activities/activity))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/activities/activity" at="if(count(/derogations/derogation[index('rDerogList')]/activities/activity)=1,0,count(/derogations/derogation[index('rDerogList')]/activities/activity))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/activities/activity" at="if(count(/derogations/derogation[index('rDerogList')]/activities/activity)=1,0,count(/derogations/derogation[index('rDerogList')]/activities/activity))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/activities/activity" at="if(count(/derogations/derogation[index('rDerogList')]/activities/activity)=1,0,count(/derogations/derogation[index('rDerogList')]/activities/activity))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/activities/activity" at="if(count(/derogations/derogation[index('rDerogList')]/activities/activity)=1,0,count(/derogations/derogation[index('rDerogList')]/activities/activity))"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/activities/activity[1]" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/activities/activity/@code[1]" value="''"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/methods/method" at="if(count(/derogations/derogation[index('rDerogList')]/methods/method)=1,0,count(/derogations/derogation[index('rDerogList')]/methods/method))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/methods/method" at="if(count(/derogations/derogation[index('rDerogList')]/methods/method)=1,0,count(/derogations/derogation[index('rDerogList')]/methods/method))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/methods/method" at="if(count(/derogations/derogation[index('rDerogList')]/methods/method)=1,0,count(/derogations/derogation[index('rDerogList')]/methods/method))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/methods/method" at="if(count(/derogations/derogation[index('rDerogList')]/methods/method)=1,0,count(/derogations/derogation[index('rDerogList')]/methods/method))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/methods/method" at="if(count(/derogations/derogation[index('rDerogList')]/methods/method)=1,0,count(/derogations/derogation[index('rDerogList')]/methods/method))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/methods/method" at="if(count(/derogations/derogation[index('rDerogList')]/methods/method)=1,0,count(/derogations/derogation[index('rDerogList')]/methods/method))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/methods/method" at="if(count(/derogations/derogation[index('rDerogList')]/methods/method)=1,0,count(/derogations/derogation[index('rDerogList')]/methods/method))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/methods/method" at="if(count(/derogations/derogation[index('rDerogList')]/methods/method)=1,0,count(/derogations/derogation[index('rDerogList')]/methods/method))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/methods/method" at="if(count(/derogations/derogation[index('rDerogList')]/methods/method)=1,0,count(/derogations/derogation[index('rDerogList')]/methods/method))"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/methods/method[1]" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/methods/method/@code[1]" value="''"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/reasons/reason" at="if(count(/derogations/derogation[index('rDerogList')]/reasons/reason)=1,0,count(/derogations/derogation[index('rDerogList')]/reasons/reason))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/reasons/reason" at="if(count(/derogations/derogation[index('rDerogList')]/reasons/reason)=1,0,count(/derogations/derogation[index('rDerogList')]/reasons/reason))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/reasons/reason" at="if(count(/derogations/derogation[index('rDerogList')]/reasons/reason)=1,0,count(/derogations/derogation[index('rDerogList')]/reasons/reason))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/reasons/reason" at="if(count(/derogations/derogation[index('rDerogList')]/reasons/reason)=1,0,count(/derogations/derogation[index('rDerogList')]/reasons/reason))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/reasons/reason" at="if(count(/derogations/derogation[index('rDerogList')]/reasons/reason)=1,0,count(/derogations/derogation[index('rDerogList')]/reasons/reason))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/reasons/reason" at="if(count(/derogations/derogation[index('rDerogList')]/reasons/reason)=1,0,count(/derogations/derogation[index('rDerogList')]/reasons/reason))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/reasons/reason" at="if(count(/derogations/derogation[index('rDerogList')]/reasons/reason)=1,0,count(/derogations/derogation[index('rDerogList')]/reasons/reason))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/reasons/reason" at="if(count(/derogations/derogation[index('rDerogList')]/reasons/reason)=1,0,count(/derogations/derogation[index('rDerogList')]/reasons/reason))"/>
                <f:delete nodeset="/derogations/derogation[index('rDerogList')]/reasons/reason" at="if(count(/derogations/derogation[index('rDerogList')]/reasons/reason)=1,0,count(/derogations/derogation[index('rDerogList')]/reasons/reason))"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/reasons/reason[1]" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/reasons/reason/@code[1]" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/strictlySupervisedConditions" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/selectiveBasis" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/derogationJustification" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licensed/individuals" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licensed/eggs" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licensed/breeding" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licensed/nests" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licensed/resting" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licensed/otherType" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licensed/otherNumber" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licensedJustification" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/actuallyTaken/individuals" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/actuallyTaken/eggs" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/actuallyTaken/breeding" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/actuallyTaken/nests" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/actuallyTaken/resting" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/actuallyTaken/otherType" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/actuallyTaken/otherNumber" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/populationSize/individuals" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/populationSize/breedingPairs" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/populationSize/otherType" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/populationSize/otherNumber" value="'0'"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/impactOnPopulation" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/supervisoryMeasure" value="''"/>
                <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/comments" value="''"/>
                <f:rebuild/>
            </f:action>
            <f:action ev:event="my-copy-all">
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/@user_derogation_reference" value="/derogations/derogation[index('rDerogList')]/@user_derogation_reference"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/licensingAuthority" value="/derogations/derogation[index('rDerogList')]/licensingAuthority"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/licenseValidFrom" value="/derogations/derogation[index('rDerogList')]/licenseValidFrom"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/licenseValidUntil" value="/derogations/derogation[index('rDerogList')]/licenseValidUntil"/>
						
<!-- copy species -->
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="1" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="2" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="3" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="4" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="5" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="6" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="7" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="8" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="9" position="after"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/species[1]" value="/derogations/derogation[index('rDerogList')]/species[1]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/species[2]" value="/derogations/derogation[index('rDerogList')]/species[2]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/species[3]" value="/derogations/derogation[index('rDerogList')]/species[3]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/species[4]" value="/derogations/derogation[index('rDerogList')]/species[4]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/species[5]" value="/derogations/derogation[index('rDerogList')]/species[5]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/species[6]" value="/derogations/derogation[index('rDerogList')]/species[6]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/species[7]" value="/derogations/derogation[index('rDerogList')]/species[7]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/species[8]" value="/derogations/derogation[index('rDerogList')]/species[8]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/species[9]" value="/derogations/derogation[index('rDerogList')]/species[9]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/species[10]" value="/derogations/derogation[index('rDerogList')]/species[10]"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="if(string-length(../species[10])&gt;0,0,10)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="if(string-length(../species[9])&gt;0,0,9)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="if(string-length(../species[8])&gt;0,0,8)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="if(string-length(../species[7])&gt;0,0,7)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="if(string-length(../species[6])&gt;0,0,6)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="if(string-length(../species[6])&gt;0,0,6)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="if(string-length(../species[5])&gt;0,0,5)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="if(string-length(../species[4])&gt;0,0,4)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="if(string-length(../species[3])&gt;0,0,3)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/species" at="if(string-length(../species[2])&gt;0,0,2)"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/sensitive" value="/derogations/derogation[index('rDerogList')]/sensitive"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/numberOfLicenses" value="/derogations/derogation[index('rDerogList')]/numberOfLicenses"/>


<!-- copy bioRegions -->
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="1" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="2" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="3" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="4" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="5" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="6" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="7" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="8" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="9" position="after"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[1]" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[1]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[2]" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[2]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[3]" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[3]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[4]" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[4]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[5]" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[5]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[6]" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[6]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[7]" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[7]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[8]" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[8]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[9]" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[9]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[10]" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[10]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[1]/@code" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[1]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[2]/@code" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[2]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[3]/@code" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[3]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[4]/@code" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[4]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[5]/@code" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[5]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[6]/@code" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[6]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[7]/@code" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[7]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[8]/@code" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[8]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[9]/@code" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[9]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion[10]/@code" value="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[10]/@code"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="if(string-length(../bioRegion[10]/@code)&gt;0,0,10)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="if(string-length(../bioRegion[9]/@code)&gt;0,0,9)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="if(string-length(../bioRegion[8]/@code)&gt;0,0,8)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="if(string-length(../bioRegion[7]/@code)&gt;0,0,7)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="if(string-length(../bioRegion[6]/@code)&gt;0,0,6)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="if(string-length(../bioRegion[6]/@code)&gt;0,0,6)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="if(string-length(../bioRegion[5]/@code)&gt;0,0,5)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="if(string-length(../bioRegion[4]/@code)&gt;0,0,4)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="if(string-length(../bioRegion[3]/@code)&gt;0,0,3)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/bioRegions/bioRegion" at="if(string-length(../bioRegion[2]/@code)&gt;0,0,2)"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/location" value="/derogations/derogation[index('rDerogList')]/location"/>


<!-- copy regions -->
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="1" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="2" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="3" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="4" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="5" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="6" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="7" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="8" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="9" position="after"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[1]" value="/derogations/derogation[index('rDerogList')]/regions/region[1]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[2]" value="/derogations/derogation[index('rDerogList')]/regions/region[2]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[3]" value="/derogations/derogation[index('rDerogList')]/regions/region[3]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[4]" value="/derogations/derogation[index('rDerogList')]/regions/region[4]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[5]" value="/derogations/derogation[index('rDerogList')]/regions/region[5]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[6]" value="/derogations/derogation[index('rDerogList')]/regions/region[6]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[7]" value="/derogations/derogation[index('rDerogList')]/regions/region[7]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[8]" value="/derogations/derogation[index('rDerogList')]/regions/region[8]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[9]" value="/derogations/derogation[index('rDerogList')]/regions/region[9]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[10]" value="/derogations/derogation[index('rDerogList')]/regions/region[10]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[1]/@code" value="/derogations/derogation[index('rDerogList')]/regions/region[1]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[2]/@code" value="/derogations/derogation[index('rDerogList')]/regions/region[2]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[3]/@code" value="/derogations/derogation[index('rDerogList')]/regions/region[3]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[4]/@code" value="/derogations/derogation[index('rDerogList')]/regions/region[4]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[5]/@code" value="/derogations/derogation[index('rDerogList')]/regions/region[5]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[6]/@code" value="/derogations/derogation[index('rDerogList')]/regions/region[6]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[7]/@code" value="/derogations/derogation[index('rDerogList')]/regions/region[7]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[8]/@code" value="/derogations/derogation[index('rDerogList')]/regions/region[8]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[9]/@code" value="/derogations/derogation[index('rDerogList')]/regions/region[9]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/regions/region[10]/@code" value="/derogations/derogation[index('rDerogList')]/regions/region[10]/@code"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="if(string-length(../region[10]/@code)&gt;0,0,10)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="if(string-length(../region[9]/@code)&gt;0,0,9)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="if(string-length(../region[8]/@code)&gt;0,0,8)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="if(string-length(../region[7]/@code)&gt;0,0,7)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="if(string-length(../region[6]/@code)&gt;0,0,6)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="if(string-length(../region[6]/@code)&gt;0,0,6)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="if(string-length(../region[5]/@code)&gt;0,0,5)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="if(string-length(../region[4]/@code)&gt;0,0,4)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="if(string-length(../region[3]/@code)&gt;0,0,3)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/regions/region" at="if(string-length(../region[2]/@code)&gt;0,0,2)"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/alternativesAssessed" value="/derogations/derogation[index('rDerogList')]/alternativesAssessed"/>



<!-- copy activities -->
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="1" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="2" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="3" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="4" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="5" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="6" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="7" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="8" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="9" position="after"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[1]" value="/derogations/derogation[index('rDerogList')]/activities/activity[1]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[2]" value="/derogations/derogation[index('rDerogList')]/activities/activity[2]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[3]" value="/derogations/derogation[index('rDerogList')]/activities/activity[3]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[4]" value="/derogations/derogation[index('rDerogList')]/activities/activity[4]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[5]" value="/derogations/derogation[index('rDerogList')]/activities/activity[5]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[6]" value="/derogations/derogation[index('rDerogList')]/activities/activity[6]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[7]" value="/derogations/derogation[index('rDerogList')]/activities/activity[7]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[8]" value="/derogations/derogation[index('rDerogList')]/activities/activity[8]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[9]" value="/derogations/derogation[index('rDerogList')]/activities/activity[9]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[10]" value="/derogations/derogation[index('rDerogList')]/activities/activity[10]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[1]/@code" value="/derogations/derogation[index('rDerogList')]/activities/activity[1]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[2]/@code" value="/derogations/derogation[index('rDerogList')]/activities/activity[2]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[3]/@code" value="/derogations/derogation[index('rDerogList')]/activities/activity[3]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[4]/@code" value="/derogations/derogation[index('rDerogList')]/activities/activity[4]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[5]/@code" value="/derogations/derogation[index('rDerogList')]/activities/activity[5]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[6]/@code" value="/derogations/derogation[index('rDerogList')]/activities/activity[6]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[7]/@code" value="/derogations/derogation[index('rDerogList')]/activities/activity[7]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[8]/@code" value="/derogations/derogation[index('rDerogList')]/activities/activity[8]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[9]/@code" value="/derogations/derogation[index('rDerogList')]/activities/activity[9]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/activities/activity[10]/@code" value="/derogations/derogation[index('rDerogList')]/activities/activity[10]/@code"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="if(string-length(../activity[10]/@code)&gt;0,0,10)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="if(string-length(../activity[9]/@code)&gt;0,0,9)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="if(string-length(../activity[8]/@code)&gt;0,0,8)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="if(string-length(../activity[7]/@code)&gt;0,0,7)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="if(string-length(../activity[6]/@code)&gt;0,0,6)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="if(string-length(../activity[6]/@code)&gt;0,0,6)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="if(string-length(../activity[5]/@code)&gt;0,0,5)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="if(string-length(../activity[4]/@code)&gt;0,0,4)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="if(string-length(../activity[3]/@code)&gt;0,0,3)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/activities/activity" at="if(string-length(../activity[2]/@code)&gt;0,0,2)"/>



<!-- copy methods -->
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="1" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="2" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="3" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="4" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="5" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="6" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="7" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="8" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="9" position="after"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[1]" value="/derogations/derogation[index('rDerogList')]/methods/method[1]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[2]" value="/derogations/derogation[index('rDerogList')]/methods/method[2]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[3]" value="/derogations/derogation[index('rDerogList')]/methods/method[3]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[4]" value="/derogations/derogation[index('rDerogList')]/methods/method[4]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[5]" value="/derogations/derogation[index('rDerogList')]/methods/method[5]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[6]" value="/derogations/derogation[index('rDerogList')]/methods/method[6]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[7]" value="/derogations/derogation[index('rDerogList')]/methods/method[7]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[8]" value="/derogations/derogation[index('rDerogList')]/methods/method[8]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[9]" value="/derogations/derogation[index('rDerogList')]/methods/method[9]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[10]" value="/derogations/derogation[index('rDerogList')]/methods/method[10]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[1]/@code" value="/derogations/derogation[index('rDerogList')]/methods/method[1]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[2]/@code" value="/derogations/derogation[index('rDerogList')]/methods/method[2]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[3]/@code" value="/derogations/derogation[index('rDerogList')]/methods/method[3]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[4]/@code" value="/derogations/derogation[index('rDerogList')]/methods/method[4]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[5]/@code" value="/derogations/derogation[index('rDerogList')]/methods/method[5]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[6]/@code" value="/derogations/derogation[index('rDerogList')]/methods/method[6]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[7]/@code" value="/derogations/derogation[index('rDerogList')]/methods/method[7]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[8]/@code" value="/derogations/derogation[index('rDerogList')]/methods/method[8]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[9]/@code" value="/derogations/derogation[index('rDerogList')]/methods/method[9]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/methods/method[10]/@code" value="/derogations/derogation[index('rDerogList')]/methods/method[10]/@code"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="if(string-length(../method[10]/@code)&gt;0,0,10)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="if(string-length(../method[9]/@code)&gt;0,0,9)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="if(string-length(../method[8]/@code)&gt;0,0,8)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="if(string-length(../method[7]/@code)&gt;0,0,7)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="if(string-length(../method[6]/@code)&gt;0,0,6)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="if(string-length(../method[6]/@code)&gt;0,0,6)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="if(string-length(../method[5]/@code)&gt;0,0,5)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="if(string-length(../method[4]/@code)&gt;0,0,4)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="if(string-length(../method[3]/@code)&gt;0,0,3)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/methods/method" at="if(string-length(../method[2]/@code)&gt;0,0,2)"/>


<!-- copy reasons -->
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="1" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="2" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="3" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="4" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="5" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="6" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="7" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="8" position="after"/>
                <f:insert nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="9" position="after"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[1]" value="/derogations/derogation[index('rDerogList')]/reasons/reason[1]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[2]" value="/derogations/derogation[index('rDerogList')]/reasons/reason[2]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[3]" value="/derogations/derogation[index('rDerogList')]/reasons/reason[3]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[4]" value="/derogations/derogation[index('rDerogList')]/reasons/reason[4]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[5]" value="/derogations/derogation[index('rDerogList')]/reasons/reason[5]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[6]" value="/derogations/derogation[index('rDerogList')]/reasons/reason[6]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[7]" value="/derogations/derogation[index('rDerogList')]/reasons/reason[7]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[8]" value="/derogations/derogation[index('rDerogList')]/reasons/reason[8]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[9]" value="/derogations/derogation[index('rDerogList')]/reasons/reason[9]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[10]" value="/derogations/derogation[index('rDerogList')]/reasons/reason[10]"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[1]/@code" value="/derogations/derogation[index('rDerogList')]/reasons/reason[1]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[2]/@code" value="/derogations/derogation[index('rDerogList')]/reasons/reason[2]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[3]/@code" value="/derogations/derogation[index('rDerogList')]/reasons/reason[3]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[4]/@code" value="/derogations/derogation[index('rDerogList')]/reasons/reason[4]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[5]/@code" value="/derogations/derogation[index('rDerogList')]/reasons/reason[5]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[6]/@code" value="/derogations/derogation[index('rDerogList')]/reasons/reason[6]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[7]/@code" value="/derogations/derogation[index('rDerogList')]/reasons/reason[7]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[8]/@code" value="/derogations/derogation[index('rDerogList')]/reasons/reason[8]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[9]/@code" value="/derogations/derogation[index('rDerogList')]/reasons/reason[9]/@code"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/reasons/reason[10]/@code" value="/derogations/derogation[index('rDerogList')]/reasons/reason[10]/@code"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="if(string-length(../reason[10]/@code)&gt;0,0,10)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="if(string-length(../reason[9]/@code)&gt;0,0,9)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="if(string-length(../reason[8]/@code)&gt;0,0,8)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="if(string-length(../reason[7]/@code)&gt;0,0,7)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="if(string-length(../reason[6]/@code)&gt;0,0,6)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="if(string-length(../reason[6]/@code)&gt;0,0,6)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="if(string-length(../reason[5]/@code)&gt;0,0,5)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="if(string-length(../reason[4]/@code)&gt;0,0,4)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="if(string-length(../reason[3]/@code)&gt;0,0,3)"/>
                <f:delete nodeset="/derogations/derogation[count(/derogations/derogation)]/reasons/reason" at="if(string-length(../reason[2]/@code)&gt;0,0,2)"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/strictlySupervisedConditions" value="/derogations/derogation[index('rDerogList')]/strictlySupervisedConditions"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/selectiveBasis" value="/derogations/derogation[index('rDerogList')]/selectiveBasis"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/derogationJustification" value="/derogations/derogation[index('rDerogList')]/derogationJustification"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/licensed/individuals" value="/derogations/derogation[index('rDerogList')]/licensed/individuals"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/licensed/eggs" value="/derogations/derogation[index('rDerogList')]/licensed/eggs"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/licensed/breeding" value="/derogations/derogation[index('rDerogList')]/licensed/breeding"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/licensed/nests" value="/derogations/derogation[index('rDerogList')]/licensed/nests"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/licensed/resting" value="/derogations/derogation[index('rDerogList')]/licensed/resting"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/licensed/otherType" value="/derogations/derogation[index('rDerogList')]/licensed/otherType"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/licensed/otherNumber" value="/derogations/derogation[index('rDerogList')]/licensed/otherNumber"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/licensedJustification" value="/derogations/derogation[index('rDerogList')]/licensedJustification"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/actuallyTaken/individuals" value="/derogations/derogation[index('rDerogList')]/actuallyTaken/individuals"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/actuallyTaken/eggs" value="/derogations/derogation[index('rDerogList')]/actuallyTaken/eggs"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/actuallyTaken/breeding" value="/derogations/derogation[index('rDerogList')]/actuallyTaken/breeding"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/actuallyTaken/nests" value="/derogations/derogation[index('rDerogList')]/actuallyTaken/nests"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/actuallyTaken/resting" value="/derogations/derogation[index('rDerogList')]/actuallyTaken/resting"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/actuallyTaken/otherType" value="/derogations/derogation[index('rDerogList')]/actuallyTaken/otherType"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/actuallyTaken/otherNumber" value="/derogations/derogation[index('rDerogList')]/actuallyTaken/otherNumber"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/populationSize/individuals" value="/derogations/derogation[index('rDerogList')]/populationSize/individuals"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/populationSize/breedingPairs" value="/derogations/derogation[index('rDerogList')]/populationSize/breedingPairs"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/populationSize/otherType" value="/derogations/derogation[index('rDerogList')]/populationSize/otherType"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/populationSize/otherNumber" value="/derogations/derogation[index('rDerogList')]/populationSize/otherNumber"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/impactOnPopulation" value="/derogations/derogation[index('rDerogList')]/impactOnPopulation"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/supervisoryMeasure" value="/derogations/derogation[index('rDerogList')]/supervisoryMeasure"/>
                <f:setvalue f:ref="/derogations/derogation[count(/derogations/derogation)]/comments" value="/derogations/derogation[index('rDerogList')]/comments"/>
                <f:rebuild/>
            </f:action>
        </f:model>
        <f:model id="lookups-model">

					<!-- Lookups-->
            <f:instance xmlns="" id="species" src="{$base_uri}xml/habides_species_lookup.xml"/>
            <f:instance xmlns="" id="bioregions" src="{$base_uri}xml/habides_bioregions_lookup.xml"/>
            <f:instance xmlns="" id="activities" src="{$base_uri}xml/habides_activities_lookup.xml"/>
            <f:instance xmlns="" id="methods" src="{$base_uri}xml/habides_methods_lookup.xml"/>
            <f:instance xmlns="" id="reasons" src="{$base_uri}xml/habides_reasons_lookup.xml"/>
            <f:instance xmlns="" id="countries" src="{$base_uri}xml/habides_country_lookup.xml"/>

<!-- species  -->
				<!--f:bind id="b-lowergr-label" nodeset="instance('context')/lowerGroupLabel" calculate="if(instance('directives')/directive[@id= instance('default')/derogation[index('rDerogList')]/@directive]/@type='habitats','Lower group','Family species')"/-->
            <f:bind id="b-maingroup" nodeset="instance('species')/helpers/main_groups/main_group">
                <f:bind id="b-maingroup-name" nodeset="."/>
            </f:bind>
            <f:bind id="b-middlegroup" nodeset="instance('species')/helpers/middle_groups/middle_group[@main_group=instance('context')/selMainGroup]">
                <f:bind id="b-middlegroup-name" nodeset="."/>
            </f:bind>
            <f:bind id="b-lowergroup-habitats" nodeset="instance('species')/helpers/lower_groups[@type = 'habitats']/lower_group[@middle_group=instance('context')/selMiddleGroup]">
                <f:bind id="b-lowergroup-name-habitats" nodeset="."/>
            </f:bind>
            <f:bind id="b-lowergroup-birds" nodeset="instance('species')/helpers/lower_groups[@type = 'birds']/lower_group[@middle_group=instance('context')/selMiddleGroup]">
                <f:bind id="b-lowergroup-name-birds" nodeset="."/>
            </f:bind>
            <f:bind id="b-species-list-habitats" nodeset="instance('species')/species[@type = 'habitats']/specie[lower_group=instance('context')/selLowerGroup-habitats]">
                <f:bind id="b-species-name-habitats" nodeset="specname"/>
            </f:bind>
            <f:bind id="b-species-list-birds" nodeset="instance('species')/species[@type = 'birds']/specie[lower_group=instance('context')/selLowerGroup-birds]">
                <f:bind id="b-species-name-birds" nodeset="specname"/>
            </f:bind>

			<!-- bioreg  -->
            <f:bind id="b-bioreg" nodeset="instance('bioregions')//bioregion" readonly="true()">
                <f:bind id="b-bioreg-code" nodeset="code"/>
                <f:bind id="b-bioreg-descr" nodeset="description" calculate="concat(../code,' - ', ../name)"/>
            </f:bind>
				
				<!-- reasons -->
            <f:bind id="b-reason-birds" nodeset="instance('reasons')//reason[heading=0 and @type = 'birds']" readonly="true()">
                <f:bind id="b-reason-code-birds" nodeset="code"/>
                <f:bind id="b-reason-descr-birds" nodeset="description" calculate="concat(../code,' ', ../text)"/>
            </f:bind>
            <f:bind id="b-reason-habitats" nodeset="instance('reasons')//reason[heading=0 and @type = 'habitats']" readonly="true()">
                <f:bind id="b-reason-code-habitats" nodeset="code"/>
                <f:bind id="b-reason-descr-habitats" nodeset="description" calculate="concat(../code,' ', ../text)"/>
            </f:bind>
				
				<!-- activities   -->
            <f:bind id="b-activity-birds" nodeset="instance('activities')//activity[heading=0 and @type = 'birds']">
                <f:bind id="b-activity-code-birds" nodeset="code"/>
                <f:bind id="b-activity-descr-birds" nodeset="description" calculate="concat(../code,' ', ../activity)"/>
            </f:bind>
            <f:bind id="b-activity-habitats" nodeset="instance('activities')//activity[heading=0 and @type = 'habitats']">
                <f:bind id="b-activity-code-habitats" nodeset="code"/>
                <f:bind id="b-activity-descr-habitats" nodeset="description" calculate="concat(../code,' ', ../activity)"/>
            </f:bind>

				<!-- activities   -->
            <f:bind id="b-method-birds" nodeset="instance('methods')//method[heading=0 and @type = 'birds']" readonly="true()">
                <f:bind id="b-method-code-birds" nodeset="code"/>
                <f:bind id="b-method-descr-birds" nodeset="description" calculate="concat(../code,' ', ../text)"/>
            </f:bind>
            <f:bind id="b-method-habitats" nodeset="instance('methods')//method[heading=0 and @type = 'habitats']" readonly="true()">
                <f:bind id="b-method-code-habitats" nodeset="code"/>
                <f:bind id="b-method-descr-habitats" nodeset="description" calculate="concat(../code,' ', ../text)"/>
            </f:bind>
        </f:model>
    </head>
	<!-- ##########        START FORM         ############-->
    <body>
	
		<!-- ##################################            SYSTEM MESSAGES            ############################################-->
        <f:group id="webq_sys_mess" appearance="minimal" bind="has-save-info" class="system-msg">
            <f:output bind="save-success">
                <f:label>Content saved: </f:label>
            </f:output>
            <f:output bind="save-error">
                <f:label>Save failed: </f:label>
            </f:output>
        </f:group>
		<!-- Error message -->
		<!--div id="webq_err_mess" class="error-msg">There are invalid values on the page</div-->
		<!-- ##################################            FORM HEADER            ############################################-->
        <h1>Habitats and Birds Derogations</h1>



		
		<!-- ##################################          START QUESTIONNAIRE           ############################################-->
        <f:group appearance="minimal">
            <f:select1 appearance="minimal" bind="b-country">
                <f:label class="bold">Country<span class="my-required-symbol">*</span>
                </f:label>
                <f:itemset nodeset="instance('countries')/data">
                    <f:label ref="name"/>
                    <f:hint ref="code"/>
                    <f:value ref="code"/>
                </f:itemset>
            </f:select1>
			<!--f:select1 bind="b-lang" appearance="minimal">
				<f:label class="bold">Language:</f:label>
				<f:itemset nodeset="instance('report_languages')/lang">
					<f:label ref="@desc"/>
					<f:value ref="."/>
				</f:itemset>
			</f:select1-->
            <f:input ref="instance('context')/user">
                <f:label class="bold">User Identity:</f:label>
            </f:input>
			<!--f:output ref="instance('context')/activeDirective">
				<f:label>DIR:</f:label>
			</f:output>
			
			<f:output ref="instance('context')/derogIndex">
				<f:label>D IDX</f:label>
			</f:output-->
        </f:group>
        <f:group>

		<!-- ##################################        TABS          ############################################-->
            <f:switch appearance="full">
                <f:case id="switch-toggles">
                    <f:trigger>
                        <f:label>Derogations list</f:label>
                        <f:toggle case="list-derogations"/>
                        <f:dispatch targetid="main-model" name="my-reset-edits"/>
					<!--f:dispatch targetid="main-model" name="my-store-dates"/-->
                        <f:refresh/>
                    </f:trigger>
                    <f:trigger bind="b-derogation-tblfilled">
                        <f:label>View derogation</f:label>
                        <f:toggle case="view-derogation"/>
                        <f:dispatch targetid="main-model" name="my-reset-edits"/>
                        <f:dispatch targetid="main-model" name="my-set-directive"/>
                    </f:trigger>
                    <f:trigger bind="b-derogation-tblfilled">
                        <f:label>Edit derogation</f:label>
                        <f:toggle case="edit-derogation"/>
                        <f:dispatch targetid="main-model" name="my-edit"/>
						<!--f:refresh/-->
                    </f:trigger>
				<!--f:trigger bind="b-derogation-tblfilled">
					<f:label>Edit species</f:label>
						<f:toggle case="edit-species"/>
							<f:dispatch targetid="main-model" name="my-set-directive" />
						<f:dispatch targetid="main-model" name="my-reset-species"/>
						<f:dispatch targetid="main-model" name="my-edit-species"/>
						<f:refresh/>
				</f:trigger-->
                </f:case>
                <f:case id="list-derogations" selected="true">
			<!--List-->


		<!-- ##################################         DEROGATIONS LIST           ############################################-->

						<!--f:output value="derogation/@directive"><f:label class="bold">Directive</f:label></f:output-->
                    <f:repeat id="rDerogList" nodeset="derogation" appearance="compact">
                        <f:output value="@derogation_reference">
                            <f:label class="bold">Derogation Reference</f:label>
                        </f:output>
                        <f:output value="licenseValidFrom">
                            <f:label class="bold">License Valid From</f:label>
                        </f:output>
                        <f:output value="licenseValidUntil">
                            <f:label class="bold">License Valid Until</f:label>
                        </f:output>
                        <f:output value="if(@directive='') then ' ' else sensitive">
                            <f:label class="bold">Sensitive</f:label>
                        </f:output>
						<!--f:output value="species"><f:label class="bold">Species</f:label></f:output-->
                        <f:trigger appearance="minimal">
                            <f:label bind="b-lblView"/>
                            <f:toggle case="view-derogation"/>
                            <f:dispatch targetid="main-model" name="my-set-directive"/>
                            <f:refresh/>
                        </f:trigger>
                        <f:trigger appearance="minimal">
                            <f:label bind="b-lblEdit"/>
                            <f:toggle case="edit-derogation"/>
                            <f:dispatch targetid="main-model" name="my-edit"/>
                            <f:refresh/>
							<!--f:dispatch targetid="main-model" name="my-reset-edits"/-->
                        </f:trigger>
                        <f:trigger appearance="minimal">
                            <f:label bind="b-lblCopy"/>
                            <f:dispatch targetid="main-model" name="my-set-directive"/>
                            <f:insert nodeset="/derogations/derogation" at="count(/derogations/derogation)" position="after"/>
                            <f:dispatch targetid="main-model" name="my-insert"/>
                            <f:dispatch targetid="main-model" name="my-reset-all"/>
                            <f:refresh/>
                            <f:setindex repeat="rDerogList" index="instance('context')/derogIndex"/>
                            <f:dispatch targetid="main-model" name="my-copy-all"/>
                            <f:setindex repeat="rDerogList" index="count(instance('default')//derogation)"/>
                            <f:refresh/>
                        </f:trigger>
                        <f:trigger appearance="minimal">
                            <f:label bind="b-lblDelete"/>
                            <f:toggle case="delete-derogation"/>
                            <f:refresh/>
                        </f:trigger>
                    </f:repeat>
                    <f:group>
                        <f:trigger bind="b-derogation-tblfilled">
                            <f:label>Create HABITATS derogation 1</f:label>
                            <f:action>
								<f:message level="modal">here</f:message>
                                <f:insert ref="instance('default')/derogations/derogation" at="last()" position="after" origin="instance('default')/derogations/derogation"/>
								<f:message level="modal">here2</f:message>
								
								<!--
                                <f:setvalue f:ref="instance('context')/activeDirective" value="'habitats'"/>
                                <f:dispatch targetid="main-model" name="my-insert"/>
                                <f:dispatch targetid="main-model" name="my-reset-all"/>
								-->
					<!--f:toggle case="list-derogations"/-->
                            </f:action>
                        </f:trigger>
                        <f:trigger bind="b-derogation-tblempty">
                            <f:label>Create HABITATS derogation</f:label>
                            <f:action ev:event="DOMActivate">
                                <f:setvalue f:ref="instance('context')/activeDirective" value="'habitats'"/>
                                <f:dispatch targetid="main-model" name="my-insert"/>
                                <f:dispatch targetid="main-model" name="my-reset-all"/>
					<!--f:toggle case="list-derogations"/-->
                            </f:action>
                        </f:trigger>
                        <f:trigger bind="b-derogation-tblfilled">
                            <f:label>Create BIRDS derogation</f:label>
                            <f:action ev:event="DOMActivate">
                                <f:insert nodeset="/derogations/derogation" at="count(/derogations/derogation)" position="after"/>
                                <f:refresh/>
                                <f:setvalue f:ref="instance('context')/activeDirective" value="'birds'"/>
                                <f:dispatch targetid="main-model" name="my-insert"/>
                                <f:dispatch targetid="main-model" name="my-reset-all"/>
					<!--f:toggle case="list-derogations"/-->
                            </f:action>
                        </f:trigger>
                        <f:trigger bind="b-derogation-tblempty">
                            <f:label>Create BIRDS derogation</f:label>
                            <f:action ev:event="DOMActivate">
                                <f:setvalue f:ref="instance('context')/activeDirective" value="'birds'"/>
                                <f:dispatch targetid="main-model" name="my-insert"/>
                                <f:dispatch targetid="main-model" name="my-reset-all"/>
					<!--f:toggle case="list-derogations"/-->
                            </f:action>
                        </f:trigger>
                    </f:group>
                </f:case>


		<!-- ##################################         DELETE           ############################################-->
                <f:case id="delete-derogation" selected="false">
                    <f:group>
                        <f:output class="bold" value="concat('Are you sure you want to delete derogation ',/derogations/derogation[index('rDerogList')]/@derogation_reference,'?')"/>
                        <f:trigger>
                            <f:label> Delete </f:label>
                            <f:action ev:event="DOMActivate">
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/@directive" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/@userIdentity" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/@derogation_reference" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/@user_derogation_ref" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/licensingAuthority" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/licenseValidFrom" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/licenseValidUntil" value="''"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/species" at="if(count(/derogations/derogation[index('rDerogList')]/species)=1,0,1)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/species" at="if(count(/derogations/derogation[index('rDerogList')]/species)=1,0,1)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/species" at="if(count(/derogations/derogation[index('rDerogList')]/species)=1,0,1)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/species" at="if(count(/derogations/derogation[index('rDerogList')]/species)=1,0,1)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/species" at="if(count(/derogations/derogation[index('rDerogList')]/species)=1,0,1)"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/species[1]" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/sensitive" value="'false'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/numberOfLicenses" value="0"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion)&gt;1,1,0)"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion[1]" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/bioRegions/bioRegion/@code[1]" value="''"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/regions/region" at="if(count(instance('default')/derogation[index('rDerogList')]/regions/region)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/regions/region" at="if(count(instance('default')/derogation[index('rDerogList')]/regions/region)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/regions/region" at="if(count(instance('default')/derogation[index('rDerogList')]/regions/region)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/regions/region" at="if(count(instance('default')/derogation[index('rDerogList')]/regions/region)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/regions/region" at="if(count(instance('default')/derogation[index('rDerogList')]/regions/region)&gt;1,1,0)"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/regions/region[1]" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/regions/region/@code[1]" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/location" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/alternativesAssessed" value="''"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/activities/activity" at="if(count(instance('default')/derogation[index('rDerogList')]/activities/activity)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/activities/activity" at="if(count(instance('default')/derogation[index('rDerogList')]/activities/activity)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/activities/activity" at="if(count(instance('default')/derogation[index('rDerogList')]/activities/activity)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/activities/activity" at="if(count(instance('default')/derogation[index('rDerogList')]/activities/activity)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/activities/activity" at="if(count(instance('default')/derogation[index('rDerogList')]/activities/activity)&gt;1,1,0)"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/activities/activity[1]" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/activities/activity/@code[1]" value="''"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/methods/method" at="if(count(instance('default')/derogation[index('rDerogList')]/methods/method)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/methods/method" at="if(count(instance('default')/derogation[index('rDerogList')]/methods/method)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/methods/method" at="if(count(instance('default')/derogation[index('rDerogList')]/methods/method)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/methods/method" at="if(count(instance('default')/derogation[index('rDerogList')]/methods/method)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/methods/method" at="if(count(instance('default')/derogation[index('rDerogList')]/methods/method)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/methods/method" at="if(count(instance('default')/derogation[index('rDerogList')]/methods/method)&gt;1,1,0)"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/methods/method[1]" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/methods/method/@code[1]" value="''"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/reasons/reason" at="if(count(instance('default')/derogation[index('rDerogList')]/reasons/reason)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/reasons/reason" at="if(count(instance('default')/derogation[index('rDerogList')]/reasons/reason)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/reasons/reason" at="if(count(instance('default')/derogation[index('rDerogList')]/reasons/reason)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/reasons/reason" at="if(count(instance('default')/derogation[index('rDerogList')]/reasons/reason)&gt;1,1,0)"/>
                                <f:delete nodeset="instance('default')/derogation[index('rDerogList')]/reasons/reason" at="if(count(instance('default')/derogation[index('rDerogList')]/reasons/reason)&gt;1,1,0)"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/reasons/reason[1]" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/reasons/reason/@code[1]" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/strictlySupervisedConditions" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/selectiveBasis" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/derogationJustification" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/licensed/individuals" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/licensed/eggs" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/licensed/breeding" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/licensed/nests" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/licensed/resting" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/licensed/otherType" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/licensed/otherNumber" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/licensedJustification" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/actuallyTaken/individuals" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/actuallyTaken/eggs" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/actuallyTaken/breeding" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/actuallyTaken/nests" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/actuallyTaken/resting" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/actuallyTaken/otherType" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/actuallyTaken/otherNumber" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/populationSize/individuals" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/populationSize/breedingPairs" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/populationSize/otherType" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/populationSize/otherNumber" value="'0'"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/impactOnPopulation" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/supervisoryMeasure" value="''"/>
                                <f:setvalue f:ref="instance('default')/derogation[index('rDerogList')]/comments" value="''"/>
                                <f:delete nodeset="instance('default')/derogation" at="if(count(instance('default')/derogation)=1,0,index('rDerogList'))"/>
                                <f:toggle case="list-derogations"/>
                            </f:action>
                        </f:trigger>
                        <f:trigger>
                            <f:label> Cancel </f:label>
                            <f:action ev:event="DOMActivate">
                                <f:toggle case="list-derogations"/>
                            </f:action>
                        </f:trigger>
                    </f:group>
                </f:case>


		<!-- ##################################       VIEW           ############################################-->
                <f:case id="view-derogation" selected="false">
                </f:case>
            



            		<!-- ##################################         EDIT           ############################################-->
                <f:case id="edit-derogation" selected="false">
				<!--f:output value="index('rDerogList')"><f:label>Derogation Valid From</f:label></f:output-->
                    <f:group bind="b-derogation-tblfilled">
                        <f:group id="gDerogEdit" appearance="compact" ref="instance('default')/derogation[index('rDerogList')]">
                            <f:group appearance="minimal">
                                <f:output class="bold small-heading" value="instance('directives')/directive[@id=/derogations/derogation[index('rDerogList')]/@directive]">
                                    <f:label/>
                                </f:output>
                            </f:group>
                            <f:group appearance="compact">
                                <f:input class="semi-wide-inp" ref="@derogation_reference">
                                    <f:label class="bold">Derogation Reference<span class="my-required-symbol">*</span>
                                    </f:label>
                                </f:input>
                                <div class="divider"/>
                                <f:input class="semi-wide-inp" ref="@user_derogation_ref">
                                    <f:label class="bold">User Derogation Reference:</f:label>
                                </f:input>
                                <div class="divider"/>
                                <f:input ref="@userIdentity">
                                    <f:label class="bold">User Identity:</f:label>
                                </f:input>
                            </f:group>
                            <f:group appearance="compact">
                                <f:input class="wide-inp" ref="licensingAuthority">
                                    <f:label class="bold">Licensing authority<span class="my-required-symbol">*</span>
                                    </f:label>
                                </f:input>
                                <div class="divider"/>
						<!--f:input ref="sensitive"><f:label class="red bold">Sensitive</f:label></f:input-->
                                <f:input bind="b-contextSensitive">
                                    <f:label class="red bold">Sensitive</f:label>
                                    <f:action ev:event="xforms-value-changed">
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/sensitive" value="instance('context')/sensitive"/>
                                    </f:action>
                                </f:input>
                            </f:group>
                            <f:group appearance="compact">
						<!--f:input ref="licenseValidFrom"><f:label>License valid from</f:label></f:input>
						<f:input ref="licenseValidUntil"><f:label>License valid until</f:label></f:input-->
                                <f:input bind="b-contextValidFrom">
                                    <f:label class="bold">License valid from<span class="my-required-symbol">*</span>
                                    </f:label>
                                    <f:alert>"valid from" should be before "valid until"</f:alert>
                                    <f:action ev:event="xforms-value-changed">
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licenseValidFrom" value="instance('context')/validFrom"/>
                                    </f:action>
                                </f:input>
                                <div class="divider"/>
                                <f:input bind="b-contextValidUntil">
                                    <f:label class="bold">License valid until<span class="my-required-symbol">*</span>
                                    </f:label>
                                    <f:alert>"valid from" should be before "valid until"</f:alert>
                                    <f:action ev:event="xforms-value-changed">
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/licenseValidUntil" value="instance('context')/validUntil"/>
                                    </f:action>
                                </f:input>
                            </f:group>
					<!--
					<f:group appearance="full">
						<f:output class="bold" ref="licenseValidFrom"><f:label>License valid from</f:label></f:output>
						<f:output class="bold" ref="licenseValidUntil"><f:label>License valid until</f:label></f:output>
					</f:group>
-->
                            <f:group appearance="compact">
                                <f:input ref="numberOfLicenses" class="bold">
                                    <f:label>Number of licenses</f:label>
                                    <f:alert>Numeric field</f:alert>
                                </f:input>
                            </f:group>
					
<!-- SPECIES  -->					
<!-- -->
                            <f:group appearance="full">
                                <f:label class="bold">Species<span class="my-required-symbol">*</span>
                                </f:label>
                                <f:group appearance="compact" bind="b-species-tblempty">
                                    <div class="my-alert">Species are not specified!</div>
                                </f:group>
                                <f:group appearance="compact">
                                    <f:label>Inserted species</f:label>
                                    <f:repeat appearance="compact" id="rSpecies" nodeset="species" class="habides-repeat">
                                        <f:output ref="." class="wide-inp">
                                            <f:label/>
                                        </f:output>
                                        <f:trigger appearance="minimal" bind="b-species-tblfilled">
                                            <f:label>Remove</f:label>
                                            <f:delete nodeset="/derogations/derogation[index('rDerogList')]/species" at="if(count(/derogations/derogation[index('rDerogList')]/species)=1,0,index('rSpecies'))"/>
                                            <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/species[1]" value="if(count(/derogations/derogation[index('rDerogList')]/species) = 1, '', /derogations/derogation[index('rDerogList')]/species[1])"/>
                                        </f:trigger>
                                    </f:repeat>
                                </f:group>
                                <f:select1 ref="instance('context')/selMainGroup" appearance="minimal">
                                    <f:label>Main group</f:label>&gt;
						<f:itemset bind="b-maingroup">
                                        <f:label bind="b-maingroup-name"/>
                                        <f:value bind="b-maingroup-name"/>
                                    </f:itemset>
                                </f:select1>
                                <f:select1 ref="instance('context')/selMiddleGroup" appearance="minimal">
                                    <f:label>Middle group</f:label>&gt;
						<f:itemset bind="b-middlegroup">
                                        <f:label bind="b-middlegroup-name"/>
                                        <f:value bind="b-middlegroup-name"/>
                                    </f:itemset>
                                </f:select1>
                                <f:select1 ref="instance('context')/selLowerGroup-birds" appearance="minimal">
                                    <f:label>Family species</f:label>
                                    <f:itemset bind="b-lowergroup-birds">
                                        <f:label bind="b-lowergroup-name-birds"/>
                                        <f:value bind="b-lowergroup-name-birds"/>
                                    </f:itemset>
                                </f:select1>
                                <f:select1 ref="instance('context')/selSpecies-birds" appearance="minimal">
                                    <f:label>Species name</f:label>&gt;
						<f:itemset bind="b-species-list-birds">
                                        <f:label bind="b-species-name-birds"/>
                                        <f:value bind="b-species-name-birds"/>
                                    </f:itemset>
                                </f:select1>
                                <f:select1 ref="instance('context')/selLowerGroup-habitats" appearance="minimal">
                                    <f:label>Lower group</f:label>
                                    <f:itemset bind="b-lowergroup-habitats">
                                        <f:label bind="b-lowergroup-name-habitats"/>
                                        <f:value bind="b-lowergroup-name-habitats"/>
                                    </f:itemset>
                                </f:select1>
                                <f:select1 ref="instance('context')/selSpecies-habitats" appearance="minimal">
                                    <f:label>Species name</f:label>&gt;
						<f:itemset bind="b-species-list-habitats">
                                        <f:label bind="b-species-name-habitats"/>
                                        <f:value bind="b-species-name-habitats"/>
                                    </f:itemset>
                                </f:select1>
                                <f:input class="wide-inp" bind="b-species-freetext-value">
                                    <f:label>Freetext value</f:label>
                                </f:input>
                                <div class="mygroup freetext">
                                    <f:trigger bind="b-species-tblempty">
                                        <f:label> Add species </f:label>
                                        <f:action ev:event="DOMActivate">
                                            <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/species[index('rSpecies')]" value="if (string-length(instance('context')/*[name()=concat('selSpecies-',instance('context')/activeDirective)])&gt;0,instance('context')/*[name()=concat('selSpecies-',instance('context')/activeDirective)],instance('context')/speciesFreetextValue)"/>
                                            <f:setvalue f:ref="instance('context')/*[name()=concat('selSpecies-',instance('context')/activeDirective)]" value="''"/>
                                            <f:setvalue f:ref="instance('context')/speciesFreetextValue" value="''"/>
                                        </f:action>
                                    </f:trigger>
                                    <f:trigger bind="b-species-tblfilled">
                                        <f:label> Add species </f:label>
                                        <f:action ev:event="DOMActivate">
                                            <f:insert nodeset="/derogations/derogation[index('rDerogList')]/species" at="count(/derogations/derogation[index('rDerogList')]/species)" position="after"/>
                                            <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/species[index('rSpecies')]" value="if (string-length(instance('context')/*[name()=concat('selSpecies-',instance('context')/activeDirective)])&gt;0,instance('context')/*[name()=concat('selSpecies-',instance('context')/activeDirective)],instance('context')/speciesFreetextValue)"/>
                                            <f:setvalue f:ref="instance('context')/*[name()=concat('selSpecies-',instance('context')/activeDirective)]" value="''"/>
                                            <f:setvalue f:ref="instance('context')/speciesFreetextValue" value="''"/>
                                            <f:refresh/>
                                            <f:delete at="if(/derogations/derogation[index('rDerogList')]/species[index('rSpecies')]='',last(),0)" nodeset="/derogations/derogation[index('rDerogList')]/species"/>
                                        </f:action>
                                    </f:trigger>
                                </div>
                            </f:group>

<!-- -->
                            <f:group appearance="comact" ref="derogationJustification[../@directive=instance('directives')/directive[@type='habitats']/@id]">
                                <f:label class="bold">Justification for derogation (if species in unfavourable conservation status)</f:label>
                                <f:textarea ref=".">
                                    <f:label/>
                                </f:textarea>
                            </f:group>
					
	

					
				<!-- BIO-REGIONS -->
                            <f:group appearance="full" class="regions" id="bioreg" ref="bioRegions[../@directive=instance('directives')/directive[@type='habitats']/@id]">
                                <f:label class="bold">Bio-geographical regions<span class="my-required-symbol">*</span>
                                </f:label>
                                <f:repeat appearance="compact" id="rBioReg" nodeset="bioRegion" class="habides-repeat">
                                    <f:output ref="@code">
                                        <f:label/>
                                    </f:output>
                                    <f:output ref=".">
                                        <f:label/>
                                    </f:output>
                                    <f:trigger appearance="minimal" bind="b-bioreg-tblfilled">
                                        <f:label>Remove</f:label>
                                        <f:delete nodeset="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion" at="if(count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)=1,0,index('rBioReg'))"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[index('rBioReg')]/@code" value="if(count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion) = 1, '', /derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[1]/@code)"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[index('rBioReg')]" value="if(count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion) = 1, '', /derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[1])"/>
                                    </f:trigger>
                                </f:repeat>
                                <f:select1 ref="instance('context')/selBioRegion" appearance="minimal">
                                    <f:label/>
                                    <f:itemset bind="b-bioreg">
                                        <f:label bind="b-bioreg-descr"/>
                                        <f:value bind="b-bioreg-code"/>
                                    </f:itemset>
                                </f:select1>
                                <f:trigger bind="b-bioreg-tblfilled">
                                    <f:label> Add bio-region </f:label>
                                    <f:action ev:event="DOMActivate">
                                        <f:insert nodeset="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion" at="count(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion)" position="after"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[index('rBioReg')]/@code" value="instance('context')/selBioRegion"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[index('rBioReg')]" value="instance('bioregions')//bioregion[code=instance('context')/selBioRegion]/name"/>
                                        <f:refresh/>
                                        <f:delete at="if(/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[index('rBioReg')]/@code='',last(),0)" nodeset="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion"/>
                                    </f:action>
                                </f:trigger>
                                <f:trigger bind="b-bioreg-tblempty">
                                    <f:label> Add bio-region </f:label>
                                    <f:action ev:event="DOMActivate">
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[index('rBioReg')]/@code" value="instance('context')/selBioRegion"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/bioRegions/bioRegion[index('rBioReg')]" value="instance('bioregions')//bioregion[code=instance('context')/selBioRegion]/name"/>
                                    </f:action>
                                </f:trigger>
                            </f:group>

				<!-- REGIONS -->
                            <f:group appearance="full" class="regions" id="region">
                                <f:label class="bold">Regions<span class="my-required-symbol">*</span>
                                </f:label>
                                <f:repeat appearance="compact" id="rRegion" nodeset="regions/region" class="habides-repeat">
                                    <f:output ref="@code">
                                        <f:label/>
                                    </f:output>
                                    <f:output ref=".">
                                        <f:label/>
                                    </f:output>
                                    <f:trigger appearance="minimal" bind="b-region-tblfilled">
                                        <f:label>Remove</f:label>
                                        <f:delete nodeset="/derogations/derogation[index('rDerogList')]/regions/region" at="if(count(/derogations/derogation[index('rDerogList')]/regions/region)=1,0,index('rRegion'))"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/regions/region[index('rRegion')]/@code" value="if(count(/derogations/derogation[index('rDerogList')]/regions/region) = 1, '', /derogations/derogation[index('rDerogList')]/regions/region[1]/@code)"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/regions/region[index('rRegion')]" value="if(count(/derogations/derogation[index('rDerogList')]/regions/region) = 1, '', /derogations/derogation[index('rDerogList')]/regions/region[1])"/>
                                    </f:trigger>
                                </f:repeat>
                                <f:group bind="b-country-selected">
                                    <f:select1 ref="instance('context')/selRegion" appearance="minimal">
                                        <f:label/>
                                        <f:itemset bind="b-region">
                                            <f:label bind="b-region-descr"/>
                                            <f:value bind="b-region-code"/>
                                        </f:itemset>
                                    </f:select1>
                                </f:group>
                                <f:group bind="b-country-not-selected">
                                    <f:select1 ref="instance('context')/selRegion" appearance="minimal">
                                        <f:label/>
                                        <f:itemset bind="b-region-all">
                                            <f:label bind="b-region-descr-all"/>
                                            <f:value bind="b-region-code-all"/>
                                        </f:itemset>
                                    </f:select1>
                                </f:group>
                                <f:trigger bind="b-region-tblfilled">
                                    <f:label> Add region </f:label>
                                    <f:action ev:event="DOMActivate">
                                        <f:insert nodeset="/derogations/derogation[index('rDerogList')]/regions/region" at="count(/derogations/derogation[index('rDerogList')]/regions/region)" position="after"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/regions/region[index('rRegion')]/@code" value="instance('context')/selRegion"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/regions/region[index('rRegion')]" value="instance('regions')//nuts2[code=instance('context')/selRegion]/name"/>
                                        <f:refresh/>
                                        <f:delete at="if(/derogations/derogation[index('rDerogList')]/regions/region[index('rRegion')]/@code='',last(),0)" nodeset="/derogations/derogation[index('rDerogList')]/regions/region"/>
                                    </f:action>
                                </f:trigger>
                                <f:trigger bind="b-region-tblempty">
                                    <f:label> Add region </f:label>
                                    <f:action ev:event="DOMActivate">
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/regions/region[index('rRegion')]/@code" value="instance('context')/selRegion"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/regions/region[index('rRegion')]" value="instance('regions')//nuts2[code=instance('context')/selRegion]/name"/>
                                    </f:action>
                                </f:trigger>
                            </f:group>
                            <f:group appearance="compact">
                                <f:label class="bold">Location</f:label>
                                <f:input ref="location" class="wide-inp"/>
                            </f:group>
                            <f:group appearance="compact">
                                <f:label class="bold">Alternatives assessed<span class="my-required-symbol">*</span>
                                </f:label>
                                <f:textarea ref="alternativesAssessed" class="alternatives"/>
                            </f:group>
				
				
				<!-- ACTIVITIES -->
                            <f:group appearance="full" class="activities" id="activity">
                                <f:label class="bold">Permitted Activities<span class="my-required-symbol">*</span>
                                </f:label>
                                <f:repeat appearance="compact" id="rActivity" nodeset="activities/activity" class="habides-repeat">
                                    <f:output ref="@code">
                                        <f:label/>
                                    </f:output>
                                    <f:output ref=".">
                                        <f:label/>
                                    </f:output>
                                    <f:trigger appearance="minimal" bind="b-activity-tblfilled">
                                        <f:label>Remove</f:label>
                                        <f:delete nodeset="/derogations/derogation[index('rDerogList')]/activities/activity" at="if(count(/derogations/derogation[index('rDerogList')]/activities/activity)=1,0,index('rActivity'))"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/activities/activity[index('rActivity')]/@code" value="if(count(/derogations/derogation[index('rDerogList')]/activities/activity) = 1, '', /derogations/derogation[index('rDerogList')]/activities/activity[1]/@code)"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/activities/activity[index('rActivity')]" value="if(count(/derogations/derogation[index('rDerogList')]/activities/activity) = 1, '', /derogations/derogation[index('rDerogList')]/activities/activity[1])"/>
                                    </f:trigger>
                                </f:repeat>
		<!--- Activities for brids directive   -->
                                <f:select1 bind="b-sel-activity-birds" appearance="minimal">
                                    <f:label>Activities' list</f:label>
                                    <f:itemset bind="b-activity-birds">
                                        <f:label bind="b-activity-descr-birds"/>
                                        <f:value bind="b-activity-code-birds"/>
                                    </f:itemset>
                                </f:select1>
		<!--- Activities for habitats directive   -->
                                <f:select1 bind="b-sel-activity-habitats" appearance="minimal">
                                    <f:label>Activities' list</f:label>
                                    <f:itemset bind="b-activity-habitats">
                                        <f:label bind="b-activity-descr-habitats"/>
                                        <f:value bind="b-activity-code-habitats"/>
                                    </f:itemset>
                                </f:select1>
		<!-- freetext Activities  -->
                                <f:input bind="b-ft-activity" appearance="minimal" class="wide-inp">
                                    <f:label>Other activity</f:label>
                                </f:input>
                                <f:trigger bind="b-activity-tblfilled">
                                    <f:label> Add activity </f:label>
                                    <f:action ev:event="DOMActivate">
                                        <f:insert nodeset="/derogations/derogation[index('rDerogList')]/activities/activity" at="count(/derogations/derogation[index('rDerogList')]/activities/activity)" position="after"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/activities/activity[index('rActivity')]/@code" value="if (string-length(instance('context')/*[name()=concat('selActivity-',instance('context')/activeDirective)])&gt;0,instance('context')/*[name()=concat('selActivity-',instance('context')/activeDirective)],'FT')"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/activities/activity[index('rActivity')]" value="if (string-length(instance('context')/*[name()=concat('selActivity-',instance('context')/activeDirective)])&gt;0,instance('activities')//activity[code=instance('context')/*[name()=concat('selActivity-',instance('context')/activeDirective)]]/activity,instance('context')/ftActivity)"/>
                                        <f:setvalue f:ref="instance('context')/*[name()=concat('selActivity-',instance('context')/activeDirective)]" value="''"/>
								<!--f:refresh/-->
                                        <f:setvalue f:ref="instance('context')/ftActivity" value="''"/>
                                        <f:delete at="if(/derogations/derogation[index('rDerogList')]/activities/activity[index('rActivity')]/@code='',last(),0)" nodeset="/derogations/derogation[index('rDerogList')]/activities/activity"/>
                                    </f:action>
                                </f:trigger>
                                <f:trigger bind="b-activity-tblempty">
                                    <f:label> Add  activity </f:label>
                                    <f:action ev:event="DOMActivate">
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/activities/activity[index('rActivity')]/@code" value="if (string-length(instance('context')/*[name()=concat('selActivity-',instance('context')/activeDirective)])&gt;0,instance('context')/*[name()=concat('selActivity-',instance('context')/activeDirective)],'FT')"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/activities/activity[index('rActivity')]" value="if (string-length(instance('context')/*[name()=concat('selActivity-',instance('context')/activeDirective)])&gt;0,instance('activities')//activity[code=instance('context')/*[name()=concat('selActivity-',instance('context')/activeDirective)]]/activity,instance('context')/ftActivity)"/>
                                        <f:setvalue f:ref="instance('context')/*[name()=concat('selActivity-',instance('context')/activeDirective)]" value="''"/>
                                        <f:setvalue f:ref="instance('context')/ftActivity" value="''"/>
                                    </f:action>
                                </f:trigger>
                            </f:group>

				<!-- METHODS -->
                            <f:group appearance="full" class="methods" id="method">
                                <f:label class="bold">Permitted Methods<span class="my-required-symbol">*</span>
                                </f:label>
                                <f:repeat appearance="compact" id="rMethod" nodeset="methods/method" class="habides-repeat">
							<!--f:output ref="@code"><f:label/></f:output-->
                                    <f:output ref=".">
                                        <f:label/>
                                    </f:output>
                                    <f:trigger appearance="minimal" bind="b-method-tblfilled">
                                        <f:label>Remove</f:label>
                                        <f:delete nodeset="/derogations/derogation[index('rDerogList')]/methods/method" at="if(count(/derogations/derogation[index('rDerogList')]/methods/method)=1,0,index('rMethod'))"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/methods/method[index('rMethod')]/@code" value="if(count(/derogations/derogation[index('rDerogList')]/methods/method) = 1, '', /derogations/derogation[index('rDerogList')]/methods/method[1]/@code)"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/methods/method[index('rMethod')]" value="if(count(/derogations/derogation[index('rDerogList')]/methods/method) = 1, '', /derogations/derogation[index('rDerogList')]/methods/method[1])"/>
                                    </f:trigger>
                                </f:repeat>
						

		<!--- Methods for brids directive   -->
                                <f:select1 bind="b-sel-method-birds" appearance="minimal">
                                    <f:label>Methods' list</f:label>
                                    <f:itemset bind="b-method-birds">
                                        <f:label bind="b-method-descr-birds"/>
                                        <f:value bind="b-method-code-birds"/>
                                    </f:itemset>
                                </f:select1>
		<!--- Methods for habitats directive   -->
                                <f:select1 bind="b-sel-method-habitats" appearance="minimal">
                                    <f:label>Methods' list</f:label>
                                    <f:itemset bind="b-method-habitats">
                                        <f:label bind="b-method-descr-habitats"/>
                                        <f:value bind="b-method-code-habitats"/>
                                    </f:itemset>
                                </f:select1>
		<!-- freetext method  -->
                                <f:input bind="b-ft-method" appearance="minimal" class="wide-inp">
                                    <f:label>Other method</f:label>
                                </f:input>
                                <f:trigger bind="b-method-tblfilled">
                                    <f:label> Add method </f:label>
                                    <f:action ev:event="DOMActivate">
                                        <f:insert nodeset="/derogations/derogation[index('rDerogList')]/methods/method" at="count(/derogations/derogation[index('rDerogList')]/methods/method)" position="after"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/methods/method[index('rMethod')]/@code" value="if (string-length(instance('context')/*[name()=concat('selMethod-',instance('context')/activeDirective)])&gt;0,instance('context')/*[name()=concat('selMethod-',instance('context')/activeDirective)],'FT')"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/methods/method[index('rMethod')]" value="if (string-length(instance('context')/*[name()=concat('selMethod-',instance('context')/activeDirective)])&gt;0,instance('methods')//method[code=instance('context')/*[name()=concat('selMethod-',instance('context')/activeDirective)]]/text,instance('context')/ftMethod)"/>
                                        <f:setvalue f:ref="instance('context')/*[name()=concat('selMethod-',instance('context')/activeDirective)]" value="''"/>
								<!--f:refresh/-->
                                        <f:setvalue f:ref="instance('context')/ftMethod" value="''"/>
                                        <f:delete at="if(/derogations/derogation[index('rDerogList')]/methods/method[index('rMethod')]/@code='',last(),0)" nodeset="/derogations/derogation[index('rDerogList')]/methods/method"/>
                                    </f:action>
                                </f:trigger>
                                <f:trigger bind="b-method-tblempty">
                                    <f:label> Add  method </f:label>
                                    <f:action ev:event="DOMActivate">
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/methods/method[index('rMethod')]/@code" value="if (string-length(instance('context')/*[name()=concat('selMethod-',instance('context')/activeDirective)])&gt;0,instance('context')/*[name()=concat('selMethod-',instance('context')/activeDirective)],'FT')"/>
                                        <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/methods/method[index('rMethod')]" value="if (string-length(instance('context')/*[name()=concat('selMethod-',instance('context')/activeDirective)])&gt;0,instance('methods')//method[code=instance('context')/*[name()=concat('selMethod-',instance('context')/activeDirective)]]/text,instance('context')/ftMethod)"/>
                                        <f:setvalue f:ref="instance('context')/*[name()=concat('selMethod-',instance('context')/activeDirective)]" value="''"/>
                                        <f:setvalue f:ref="instance('context')/ftMethod" value="''"/>
                                    </f:action>
                                </f:trigger>
                            </f:group>


				<!-- REASONS -->
                            <f:group appearance="full" class="methods">
                                <f:label class="bold">Reason for Granting License<span class="my-required-symbol">*</span>
                                </f:label>
                                <f:group>
                                    <f:repeat appearance="compact" id="rReason" nodeset="reasons/reason" class="habides-repeat">
                                        <f:output ref="@code">
                                            <f:label/>
                                        </f:output>
                                        <f:output ref=".">
                                            <f:label/>
                                        </f:output>
                                        <f:trigger appearance="minimal" bind="b-reason-tblfilled">
                                            <f:label>Remove</f:label>
                                            <f:delete nodeset="/derogations/derogation[index('rDerogList')]/reasons/reason" at="if(count(/derogations/derogation[index('rDerogList')]/reasons/reason)=1,0,index('rReason'))"/>
                                            <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/reasons/reason[index('rReason')]/@code" value="if(count(/derogations/derogation[index('rDerogList')]/reasons/reason) = 1, '', /derogations/derogation[index('rDerogList')]/reasons/reason[1]/@code)"/>
                                            <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/reasons/reason[index('rReason')]" value="if(count(/derogations/derogation[index('rDerogList')]/reasons/reason) = 1, '', /derogations/derogation[index('rDerogList')]/reasons/reason[1])"/>
                                        </f:trigger>
                                    </f:repeat>

		<!--- Reasons for brids directive   -->
                                    <f:select1 bind="b-sel-reason-birds" appearance="minimal">
                                        <f:label>Reasons' list</f:label>
                                        <f:itemset bind="b-reason-birds">
                                            <f:label bind="b-reason-descr-birds"/>
                                            <f:value bind="b-reason-code-birds"/>
                                        </f:itemset>
                                    </f:select1>
		<!--- Reasons for habitats directive   -->
                                    <f:select1 bind="b-sel-reason-habitats" appearance="minimal">
                                        <f:label>Reasons' list</f:label>
                                        <f:itemset bind="b-reason-habitats">
                                            <f:label bind="b-reason-descr-habitats"/>
                                            <f:value bind="b-reason-code-habitats"/>
                                        </f:itemset>
                                    </f:select1>
		<!-- freetext reason  -->
                                    <f:input bind="b-ft-reason" appearance="minimal" class="wide-inp">
                                        <f:label>Other reason</f:label>
                                    </f:input>
                                    <f:trigger bind="b-reason-tblfilled">
                                        <f:label> Add reason </f:label>
                                        <f:action ev:event="DOMActivate">
                                            <f:insert nodeset="/derogations/derogation[index('rDerogList')]/reasons/reason" at="count(/derogations/derogation[index('rDerogList')]/reasons/reason)" position="after"/>
                                            <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/reasons/reason[index('rReason')]/@code" value="if (string-length(instance('context')/*[name()=concat('selReason-',instance('context')/activeDirective)])&gt;0,instance('context')/*[name()=concat('selReason-',instance('context')/activeDirective)],'FT')"/>
                                            <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/reasons/reason[index('rReason')]" value="if (string-length(instance('context')/*[name()=concat('selReason-',instance('context')/activeDirective)])&gt;0,instance('reasons')//reason[code=instance('context')/*[name()=concat('selReason-',instance('context')/activeDirective)]]/text,instance('context')/ftReason)"/>
                                            <f:setvalue f:ref="instance('context')/*[name()=concat('selReason-',instance('context')/activeDirective)]" value="''"/>
								<!--f:refresh/-->
                                            <f:setvalue f:ref="instance('context')/ftReason" value="''"/>
                                            <f:delete at="if(/derogations/derogation[index('rDerogList')]/reasons/reason[index('rReason')]/@code='',last(),0)" nodeset="/derogations/derogation[index('rDerogList')]/reasons/reason"/>
                                        </f:action>
                                    </f:trigger>
                                    <f:trigger bind="b-reason-tblempty">
                                        <f:label> Add  reason </f:label>
                                        <f:action ev:event="DOMActivate">
                                            <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/reasons/reason[index('rReason')]/@code" value="if (string-length(instance('context')/*[name()=concat('selReason-',instance('context')/activeDirective)])&gt;0,instance('context')/*[name()=concat('selReason-',instance('context')/activeDirective)],'FT')"/>
                                            <f:setvalue f:ref="/derogations/derogation[index('rDerogList')]/reasons/reason[index('rReason')]" value="if (string-length(instance('context')/*[name()=concat('selReason-',instance('context')/activeDirective)])&gt;0,instance('reasons')//reason[code=instance('context')/*[name()=concat('selReason-',instance('context')/activeDirective)]]/text,instance('context')/ftReason)"/>
                                            <f:setvalue f:ref="instance('context')/*[name()=concat('selReason-',instance('context')/activeDirective)]" value="''"/>
                                            <f:setvalue f:ref="instance('context')/ftReason" value="''"/>
                                        </f:action>
                                    </f:trigger>
                                </f:group>
                                <f:textarea ref="strictlySupervisedConditions[../@directive=instance('directives')/directive[@type='habitats']/@id]">
                                    <f:label class="bold">Strictly supervised conditions (only for reasons 61 and 62)</f:label>
                                </f:textarea>
                                <f:textarea ref="selectiveBasis[../@directive=instance('directives')/directive[@type='habitats']/@id]">
                                    <f:label class="bold">Selective basis (only for reasons 61 and 62)</f:label>
                                </f:textarea>
                                <f:textarea ref="strictlySupervisedConditions[../@directive=instance('directives')/directive[@type='birds']/@id]">
                                    <f:label class="bold">Strictly supervised conditions (only for reasons 61, 62 and 63)</f:label>
                                </f:textarea>
                                <f:textarea ref="selectiveBasis[../@directive=instance('directives')/directive[@type='birds']/@id]">
                                    <f:label class="bold">Selective basis (only for reasons 61, 62 and 63)</f:label>
                                </f:textarea>
                            </f:group>
					
					
					<!-- LICENSES -->
                            <f:group appearance="ful">
                                <f:label class="bold">Licensed<span class="my-required-symbol">*</span>
                                </f:label>
                                <div class="mygroup">
                                    <f:input ref="licensed/individuals">
                                        <f:label>Individuals</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                    <f:input ref="licensed/eggs">
                                        <f:label>Eggs</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                    <f:input ref="licensed/breeding[../../@directive=instance('directives')/directive[@type='habitats']/@id]">
                                        <f:label>Breeding sites</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                    <f:input ref="licensed/resting[../../@directive=instance('directives')/directive[@type='habitats']/@id]">
                                        <f:label>Resting sites</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                    <f:input ref="licensed/nests[../../@directive=instance('directives')/directive[@type='birds']/@id]">
                                        <f:label>Nests</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                </div>
                                <div class="mygroup others">
                                    <f:input ref="licensed/otherType">
                                        <f:label>Others (unit)</f:label>
                                    </f:input>
                                    <f:input ref="licensed/otherNumber">
                                        <f:label>Others (number)</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                </div>
                                <div style="display:block;width:100%">
                                    <f:textarea ref="licensedJustification">
                                        <f:label>Justification (if no values given)</f:label>
                                    </f:textarea>
                                </div>
                            </f:group>


					<!-- ACTUALLY TAKEN -->
                            <f:group appearance="compact" ref="actuallyTaken">
                                <f:label class="bold">Actually taken<span class="my-required-symbol">*</span>
                                </f:label>
                                <div class="mygroup">
                                    <f:input ref="individuals">
                                        <f:label>Individuals</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                    <f:input ref="eggs">
                                        <f:label>Eggs</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                    <f:input ref="breeding[../../@directive=instance('directives')/directive[@type='habitats']/@id]">
                                        <f:label>Breeding sites</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                    <f:input ref="resting[../../@directive=instance('directives')/directive[@type='habitats']/@id]">
                                        <f:label>Resting sites</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                    <f:input ref="nests[../../@directive=instance('directives')/directive[@type='birds']/@id]">
                                        <f:label>Nests</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                </div>
                                <div class="mygroup others">
                                    <f:input ref="otherType">
                                        <f:label>Others (unit)</f:label>
                                    </f:input>
                                    <f:input ref="otherNumber">
                                        <f:label>Others (number)</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                </div>
                            </f:group>

					<!-- POPULATION SIZE -->
                            <f:group appearance="compact" ref="populationSize">
                                <f:label class="bold">Population size</f:label>
                                <div class="mygroup">
                                    <f:input ref="individuals">
                                        <f:label>Individuals</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                    <f:input ref="breedingPairs[../../@directive=instance('directives')/directive[@type='birds']/@id]">
                                        <f:label>Breeding pairs</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                </div>
                                <div class="mygroup others">
                                    <f:input ref="otherType">
                                        <f:label>Others (unit)</f:label>
                                    </f:input>
                                    <f:input ref="otherNumber">
                                        <f:label>Others (number)</f:label>
                                        <f:alert>Numeric field</f:alert>
                                    </f:input>
                                </div>
                            </f:group>
                            <f:group appearance="full">
                                <f:textarea ref="impactOnPopulation">
                                    <f:label class="bold">Impact on population<span class="my-required-symbol">*</span>
                                    </f:label>
                                </f:textarea>
                            </f:group>
                            <f:group appearance="full">
                                <f:textarea ref="supervisoryMeasure">
                                    <f:label class="bold">Supervisory body and measure<span class="my-required-symbol">*</span>
                                    </f:label>
                                </f:textarea>
                            </f:group>
                            <f:group appearance="full">
                                <f:textarea ref="comments">
                                    <f:label class="bold">Comments and notes</f:label>
                                </f:textarea>
                            </f:group>
                        </f:group>
                        <f:trigger>
                            <f:label>OK</f:label>
                            <f:action ev:event="DOMActivate">
                                <f:toggle case="list-derogations"/>
                                <f:dispatch targetid="main-model" name="my-reset-edits"/>
								<!--f:dispatch targetid="main-model" name="my-store-dates"/-->
								<!--f:refresh/-->
                            </f:action>
                        </f:trigger>
                    </f:group>
                </f:case>
            </f:switch>
        </f:group>    
	
		<!-- ##################################       List of derogations           ############################################-->

		<!-- ##################################          BUTTONS            ############################################-->
        <f:group appearance="minimal" class="buttons bottom_buttons">
            <f:trigger id="tr_savedraft">
                <f:label>Save</f:label>
                <f:hint>Saves the current status of the file into the CDR envelope, without moving away from the web form</f:hint>
                <f:action ev:event="DOMActivate">
                    <f:send submission="savedraft" name="xforms-submit"/>
                </f:action>
            </f:trigger>
            <f:trigger id="tr_finish">
                <f:label>Save &amp; Close</f:label>
                <f:hint>Saves the file into the CDR envelope and opens the envelope page</f:hint>
                <f:action ev:event="DOMActivate">
                    <f:send submission="finish" name="xforms-submit"/>
                </f:action>
            </f:trigger>
            <f:trigger id="tr_cancel2">
                <f:label>Cancel</f:label>
                <f:hint>Go back to envelope without saving any data</f:hint>
                <f:action ev:event="DOMActivate">
                    <f:load resource="{$base_uri}WebQServlet?mode=envelope&amp;instance_id={$instance_id}" show="replace"/>
                </f:action>
            </f:trigger>
        </f:group>
    </body>
</html>